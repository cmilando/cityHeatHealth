[{"path":"http://chadmilando.com/cityHeatHealth/articles/attributable_number.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Calculating attributable numbers and rates in `cityHeatHealth`","text":"first step calculating attributable numbers population data estimate. varies lot place dataset, don’t include functionality (example done can seen vignette(\"get_pop_estimates\")). Assume starting dataset entire timeframe looks like : Need transformations: pivot longer variable clean Note , processing vary application approach prescriptive ! Pivot longer: Variable clean: assume properties hold entire timeframe analysis, also make version dataset ‘year’ column. Now, quickly get condPois_1stage() condPois_2stage() objects use testing: exposures outcomes models","code":"library(data.table) data(\"ma_pop_data\") setDT(ma_pop_data) ma_pop_data #>               TOWN20 Female_0-17 Female_18-64 Female_65+ Male_0-17 Male_18-64 #>               <char>       <num>        <num>      <num>     <num>      <num> #>   1:      BARNSTABLE        3899        15017       6014      4499      14035 #>   2:          BOURNE        1891         5751       3212      1489       5302 #>   3:        BREWSTER         634         2518       2007       833       2628 #>   4:         CHATHAM         163         1477       1759       480       1265 #>   5:          DENNIS         573         3792       3133       784       4101 #>  ---                                                                          #> 347:   WEST BOYLSTON         619         2021       1107       604       2554 #> 348: WEST BROOKFIELD         343         1162        578       243       1002 #> 349:     WESTMINSTER         847         2371       1131       762       2028 #> 350:      WINCHENDON        1254         3318        711      1031       3134 #> 351:       WORCESTER       18779        67750      15995     21129      69365 #>      Male_65+ #>         <num> #>   1:     5458 #>   2:     2810 #>   3:     1721 #>   4:     1463 #>   5:     2359 #>  ---          #> 347:      790 #> 348:      495 #> 349:     1081 #> 350:      924 #> 351:    11173 ma_pop_data_long <- melt(   ma_pop_data,   id.vars = \"TOWN20\",   variable.name = \"sex_age\",   value.name = \"population\" ) ma_pop_data_long$sex_age <- as.character(ma_pop_data_long$sex_age) varnames <- strsplit(ma_pop_data_long$sex_age, \"_\", fixed = T) varnames <- data.frame(do.call(rbind, varnames)) names(varnames) <- c('sex', 'age_grp') rr <- which(varnames$sex == 'Female') varnames$sex[rr] <- 'F' rr <- which(varnames$sex == 'Male') varnames$sex[rr] <- 'M' ma_pop_data_long$sex = varnames$sex ma_pop_data_long$age_grp = varnames$age_grp ma_pop_data_long$sex_age <- NULL ma_pop_data_long #>                TOWN20 population    sex age_grp #>                <char>      <num> <char>  <char> #>    1:      BARNSTABLE       3899      F    0-17 #>    2:          BOURNE       1891      F    0-17 #>    3:        BREWSTER        634      F    0-17 #>    4:         CHATHAM        163      F    0-17 #>    5:          DENNIS        573      F    0-17 #>   ---                                           #> 2102:   WEST BOYLSTON        790      M     65+ #> 2103: WEST BROOKFIELD        495      M     65+ #> 2104:     WESTMINSTER       1081      M     65+ #> 2105:      WINCHENDON        924      M     65+ #> 2106:       WORCESTER      11173      M     65+ library(data.table) exposure_columns <- list(   \"date\" = \"date\",   \"exposure\" = \"tmax_C\",   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" )  ma_exposure_matrix <- make_exposure_matrix(   subset(ma_exposure, COUNTY20 %in% c('MIDDLESEX', 'SUFFOLK') &            year(date) %in% 2012:2015),    exposure_columns) #> Warning in make_exposure_matrix(subset(ma_exposure, COUNTY20 %in% c(\"MIDDLESEX\", : check about any NA, some corrections for this later, #>             but only in certain columns outcome_columns <- list(   \"date\" = \"date\",   \"outcome\" = \"daily_deaths\",   \"factor\" = 'age_grp',   \"factor\" = 'sex',   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" )  ma_outcomes_tbl <- make_outcome_table(subset(ma_deaths,COUNTY20 %in% c('MIDDLESEX', 'SUFFOLK') &            year(date) %in% 2012:2015), outcome_columns) ma_model <- condPois_2stage(ma_exposure_matrix, ma_outcomes_tbl, verbose = 1) #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2"},{"path":"http://chadmilando.com/cityHeatHealth/articles/attributable_number.html","id":"estimating-the-an","dir":"Articles","previous_headings":"","what":"Estimating the AN","title":"Calculating attributable numbers and rates in `cityHeatHealth`","text":"Ok now pass population. now estimate full object Remember needs compatible : single zone ma model ma_model$_ ma model factor ma_model$0-17 > think can handle way , recursion Now second step, can choose aggregation level want results . block need: spatial resolution summarizing : ->> ‘geo_unit’, ‘geo_unit_grp’, ‘’ just getting impacts > centering point: ->> lets just assume yes now, can always go back change can change agg_type different spatial resolution – either whatever group variable “” See numbers roughly Suffolk county ? won’t exactly averaging works. plot functions exist:","code":"ma_AN <- calc_AN(ma_model, ma_outcomes_tbl, ma_pop_data_long,                  agg_type = 'TOWN20',                   join_cols = 'TOWN20',                   nsim = 100,                  verbose = 2) #> -- validation passed #> -- estimate in each geo_unit #> 5    10  15  20  25  30  35  40  45  50  55   #> -- summarize by simulation #> 5    10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95  100      ma_AN$`_`$rate_table #>          TOWN20  COUNTY20 population above_MMT mean_annual_attr_rate_est #>          <char>    <char>      <num>    <lgcl>                     <num> #>   1:      ACTON MIDDLESEX      23864      TRUE                  82.79207 #>   2:      ACTON MIDDLESEX      23864     FALSE                   0.00000 #>   3:  ARLINGTON MIDDLESEX      45906      TRUE                  87.53758 #>   4:  ARLINGTON MIDDLESEX      45906     FALSE                   0.00000 #>   5:      ASHBY MIDDLESEX       3187      TRUE                  78.12990 #>  ---                                                                     #> 112: WINCHESTER MIDDLESEX      22809     FALSE                   0.00000 #> 113:   WINTHROP   SUFFOLK      19031      TRUE                  89.63008 #> 114:   WINTHROP   SUFFOLK      19031     FALSE                   0.00000 #> 115:     WOBURN MIDDLESEX      40992      TRUE                  68.91284 #> 116:     WOBURN MIDDLESEX      40992     FALSE                   0.00000 #>      mean_annual_attr_rate_lb mean_annual_attr_rate_ub #>                         <num>                    <num> #>   1:                 61.87982                105.07014 #>   2:                  0.00000                  0.00000 #>   3:                 70.11379                103.99185 #>   4:                  0.00000                  0.00000 #>   5:                 53.73588                 98.09578 #>  ---                                                   #> 112:                  0.00000                  0.00000 #> 113:                 71.92081                105.98464 #> 114:                  0.00000                  0.00000 #> 115:                 56.00071                 85.22928 #> 116:                  0.00000                  0.00000 ma_AN$`_`$number_table #>          TOWN20  COUNTY20 population above_MMT mean_annual_attr_num_est #>          <char>    <char>      <num>    <lgcl>                    <num> #>   1:      ACTON MIDDLESEX      23864      TRUE                 19.75750 #>   2:      ACTON MIDDLESEX      23864     FALSE                  0.00000 #>   3:  ARLINGTON MIDDLESEX      45906      TRUE                 40.18500 #>   4:  ARLINGTON MIDDLESEX      45906     FALSE                  0.00000 #>   5:      ASHBY MIDDLESEX       3187      TRUE                  2.49000 #>  ---                                                                    #> 112: WINCHESTER MIDDLESEX      22809     FALSE                  0.00000 #> 113:   WINTHROP   SUFFOLK      19031      TRUE                 17.05750 #> 114:   WINTHROP   SUFFOLK      19031     FALSE                  0.00000 #> 115:     WOBURN MIDDLESEX      40992      TRUE                 28.24875 #> 116:     WOBURN MIDDLESEX      40992     FALSE                  0.00000 #>      mean_annual_attr_num_lb mean_annual_attr_num_ub #>                        <num>                   <num> #>   1:               14.767000               25.073937 #>   2:                0.000000                0.000000 #>   3:               32.186437               47.738500 #>   4:                0.000000                0.000000 #>   5:                1.712563                3.126313 #>  ---                                                 #> 112:                0.000000                0.000000 #> 113:               13.687250               20.169937 #> 114:                0.000000                0.000000 #> 115:               22.955813               34.937188 #> 116:                0.000000                0.000000 ma_AN <- calc_AN(ma_model, ma_outcomes_tbl, ma_pop_data_long,                  agg_type = 'COUNTY20',                   join_cols = 'TOWN20',                   nsim = 100,                  verbose = 2) #> -- validation passed #> -- estimate in each geo_unit #> 5    10  15  20  25  30  35  40  45  50  55   #> -- summarize by simulation #> 5    10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95  100      ma_AN$`_`$rate_table #>     COUNTY20 population above_MMT mean_annual_attr_rate_est #>       <char>      <num>    <lgcl>                     <num> #> 1: MIDDLESEX    1623109      TRUE                  79.71161 #> 2: MIDDLESEX    1623109     FALSE                   0.00000 #> 3:   SUFFOLK     785443      TRUE                  91.91405 #> 4:   SUFFOLK     785443     FALSE                   0.00000 #>    mean_annual_attr_rate_lb mean_annual_attr_rate_ub #>                       <num>                    <num> #> 1:                 76.87088                 81.88135 #> 2:                  0.00000                  0.00000 #> 3:                 76.72278                102.17823 #> 4:                  0.00000                  0.00000 ma_AN$`_`$number_table #>     COUNTY20 population above_MMT mean_annual_attr_num_est #>       <char>      <num>    <lgcl>                    <num> #> 1: MIDDLESEX    1623109      TRUE                1293.8063 #> 2: MIDDLESEX    1623109     FALSE                   0.0000 #> 3:   SUFFOLK     785443      TRUE                 721.9325 #> 4:   SUFFOLK     785443     FALSE                   0.0000 #>    mean_annual_attr_num_lb mean_annual_attr_num_ub #>                      <num>                   <num> #> 1:               1247.6982               1329.0236 #> 2:                  0.0000                  0.0000 #> 3:                602.6137                802.5517 #> 4:                  0.0000                  0.0000 plot(ma_AN, table_type = 'rate', above_MMT = T) plot(ma_AN, table_type = 'rate', above_MMT = F)"},{"path":"http://chadmilando.com/cityHeatHealth/articles/attributable_number.html","id":"estimating-the-an---single","dir":"Articles","previous_headings":"","what":"Estimating the AN - single","title":"Calculating attributable numbers and rates in `cityHeatHealth`","text":"check single","code":"# run the model m2 <- condPois_1stage(exposure_matrix = ma_exposure_matrix,                    outcomes_tbl = ma_outcomes_tbl,                    multi_zone = TRUE)  ma_AN_s1 <- calc_AN(m2, ma_outcomes_tbl, ma_pop_data_long,                  agg_type = 'COUNTY20',                   join_cols = 'TOWN20',                   nsim = 100,                  verbose = 2) #> -- validation passed #> -- estimate in each geo_unit #> 5    10  15  20  25  30  35  40  45  50  55   #> -- summarize by simulation #> 5    10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95  100       ma_AN_s1$`_`$rate_table #>     COUNTY20 population above_MMT mean_annual_attr_rate_est #>       <char>      <num>    <lgcl>                     <num> #> 1: MIDDLESEX    1623109      TRUE                  81.71987 #> 2: MIDDLESEX    1623109     FALSE                   0.00000 #> 3:   SUFFOLK     785443      TRUE                  97.70585 #> 4:   SUFFOLK     785443     FALSE                   0.00000 #>    mean_annual_attr_rate_lb mean_annual_attr_rate_ub #>                       <num>                    <num> #> 1:                 81.10122                 82.63056 #> 2:                  0.00000                  0.00000 #> 3:                 93.21673                102.38692 #> 4:                  0.00000                  0.00000 plot(ma_AN_s1, \"num\", above_MMT = T)"},{"path":"http://chadmilando.com/cityHeatHealth/articles/attributable_number.html","id":"estimating-the-an---with-factors","dir":"Articles","previous_headings":"","what":"Estimating the AN - with factors","title":"Calculating attributable numbers and rates in `cityHeatHealth`","text":"case factors, can easily extend  results fictional course show kind outputs can made easily.","code":"ma_outcomes_tbl_fct <- make_outcome_table(subset(ma_deaths,COUNTY20 %in% c('MIDDLESEX', 'SUFFOLK') &            year(date) %in% 2012:2015),                                        outcome_columns,                                       collapse_to = 'age_grp')  ma_model_fct <- condPois_2stage(ma_exposure_matrix, ma_outcomes_tbl_fct, verbose = 1) #> < age_grp : 0-17 > #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2 #> < age_grp : 18-64 > #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2 #> < age_grp : 65+ > #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2  ma_AN_fct <- calc_AN(ma_model_fct, ma_outcomes_tbl_fct,                      ma_pop_data_long,                  agg_type = 'COUNTY20',                   join_cols = 'TOWN20',                   nsim = 100,                  verbose = 1) #> < age_grp : 0-17 > #> -- validation passed #> -- estimate in each geo_unit #> -- summarize by simulation #> < age_grp : 18-64 > #> -- validation passed #> -- estimate in each geo_unit #> -- summarize by simulation #> < age_grp : 65+ > #> -- validation passed #> -- estimate in each geo_unit #> -- summarize by simulation  plot(ma_AN_fct, \"num\", above_MMT = T) spatial_plot(ma_AN_fct, shp = ma_counties, table_type = \"num\", above_MMT = T)"},{"path":"http://chadmilando.com/cityHeatHealth/articles/bayesian_demo.html","id":"compare-with-spatial-model","dir":"Articles","previous_headings":"","what":"Compare with spatial model","title":"Using Spatial Bayesian methods in `cityHeatHealth`","text":"using laplace case, try mcmc Compare, now can see different","code":"m_sb2 <- condPois_sb(exposure_mat, deaths_tbl, local_shp,                       stan_type = 'laplace',                      verbose = 2,                      stan_opts = list(refresh = 200),                      use_spatial_model = 'bym2') #> -- validation passed #> -- prepare inputs #> CHELSEA  EVERETT     MALDEN  REVERE   #> Warning in getSW(shp = local_shp, ni = 1, include_self = F): has to be one #> polygon per row in `shp` #>      [,1] [,2] [,3] [,4] #> [1,]    0    1    1    0 #> [2,]    1    0    1    1 #> [3,]    1    1    0    1 #> [4,]    0    1    1    0 #>  #> -- run STAN #> Initial log joint probability = -6739.06  #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>      139      -6737.26   0.000348121      0.731762           1           1      169     #> Optimization terminated normally:   #>   Convergence detected: relative gradient magnitude is below tolerance  #> Finished in  0.1 seconds. #> Calculating Hessian  #> Calculating inverse of Cholesky factor  #> Generating draws  #> iteration: 0  #> iteration: 100  #> iteration: 200  #> iteration: 300  #> iteration: 400  #> iteration: 500  #> iteration: 600  #> iteration: 700  #> iteration: 800  #> iteration: 900  #> Finished in  0.7 seconds. #> CHELSEA  EVERETT     MALDEN  REVERE   #> -- apply estimates mx #>               CHELSEA     EVERETT        REVERE       MALDEN #> cbv1.l1  0.0451309468  0.05298088 -0.0005224117  0.017711625 #> cbv1.l2 -0.0223211761 -0.03592669  0.0184129771  0.012490790 #> cbv1.l3  0.0873424413  0.08593669  0.1029649763  0.093454486 #> cbv1.l4 -0.0335859603 -0.03578575 -0.0337628164 -0.041517343 #> cbv2.l1  0.0852368471  0.05049362 -0.0533811289  0.039648824 #> cbv2.l2  0.0166508607 -0.11934992  0.0747314454  0.055829432 #> cbv2.l3  0.1926712791  0.18510476  0.1393985118  0.118837565 #> cbv2.l4 -0.0462482063 -0.04542133 -0.0608086198 -0.054356689 #> cbv3.l1  0.0170645385  0.07301390  0.0257165131  0.038563344 #> cbv3.l2 -0.0005616437 -0.06948122  0.0223225434 -0.002010598 #> cbv3.l3  0.1718665757  0.12512136  0.1186064940  0.130222731 #> cbv3.l4 -0.0490847643 -0.01913613 -0.0655887549 -0.044893272  m_sb2$`_`$beta_mat #>            CHELSEA     EVERETT        MALDEN        REVERE #>  [1,]  0.045423333  0.05112039  1.900732e-02  0.0003361363 #>  [2,] -0.021520151 -0.03348218  1.168377e-02  0.0171357910 #>  [3,]  0.086169530  0.08576237  9.202635e-02  0.1026162647 #>  [4,] -0.033034684 -0.03701113 -4.046737e-02 -0.0336513220 #>  [5,]  0.088049683  0.04858261  3.603389e-02 -0.0514857925 #>  [6,]  0.019462978 -0.11101076  6.234808e-02  0.0752953200 #>  [7,]  0.187765616  0.18230330  1.161435e-01  0.1368418551 #>  [8,] -0.042253687 -0.04710544 -5.393741e-02 -0.0612077042 #>  [9,]  0.016094283  0.07222675  3.729183e-02  0.0263192109 #> [10,]  0.001261148 -0.06617505  4.976655e-05  0.0224012337 #> [11,]  0.172412859  0.12429712  1.292206e-01  0.1186910900 #> [12,] -0.048785974 -0.01986296 -4.510412e-02 -0.0658182839"},{"path":"http://chadmilando.com/cityHeatHealth/articles/bayesian_demo.html","id":"compare-with-spatial-model-for-leroux","dir":"Articles","previous_headings":"","what":"Compare with spatial model for leroux","title":"Using Spatial Bayesian methods in `cityHeatHealth`","text":"using laplace case, try mcmc can see, lots smoothing central estimate ! can also see leroux q value quite high bayesian notes need update number unique networks, right now many degree freedom –> just n = 1 neighbors. whats n = 2 neighbors weighting factor neighbors 2 away? think thins work. ’ll rework STAN code fewer ’ll windows update // ***** matrix[K, J] beta = rep_matrix(mu, J) + beta_star; // ***** update y[ ] compared multiple versions way comes back around bigger smoothness, fewer spatial networks –> right problem doesn’t actually reduce number problem. level smoothing yes determined user saying many levels neighbors use –> ah ha, problem (just like EpiEstim) won’t actually get betas everyplace –> wait, actually can poor-man’s recursion. point can 2-degree neighbor beta expressed J places, can just like otherwise ys, give region-specific betas (much like daily R(t)s). –> maybe two stage can weighted average? –> probably might make sense look people spatial-temporal Poisson rather . ChatGPT ideas (“low rank”) –> going better EpiEstim going scale dataset. anything get easier data. –> Essentially, SB bridge 1 stage 2 stage want granularity 1 stage, data aren’t strong enough 2 stage even blups, can SB model, sortof like many overlapping 1 stage models larger spatial groups fused together","code":"m_sb3 <- condPois_sb(exposure_mat,                       deaths_tbl, local_shp,                       stan_type = 'laplace',                      verbose = 2,                      stan_opts = list(refresh = 200),                      use_spatial_model = 'leroux') #> -- validation passed #> -- prepare inputs #> CHELSEA  EVERETT     MALDEN  REVERE   #> Warning in getSW(shp = local_shp, ni = 1, include_self = F): has to be one #> polygon per row in `shp` #>      [,1] [,2] [,3] [,4] #> [1,]    0    1    1    0 #> [2,]    1    0    1    1 #> [3,]    1    1    0    1 #> [4,]    0    1    1    0 #>  #> -- run STAN #> Initial log joint probability = -7000.25  #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>      199      -6508.32      0.101312       735.672           1           1      210     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>      399      -6441.08   0.000602857       2011.02           1           1      415     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>      599      -6421.17    0.00168537       2169.19           1           1      622     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>      799      -6419.21   0.000241764       2033.04           1           1      828     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>      999      -6418.36   3.55337e-05       1137.51           1           1     1040     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     1199      -6418.11   2.18947e-05       273.309           1           1     1249     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     1399      -6417.96   4.21693e-06       290.011      0.2871      0.2871     1456     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     1599      -6417.82   8.38522e-06       266.515           1           1     1668     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     1799      -6417.66   8.43777e-06       127.557           1           1     1875     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     1999      -6417.53   1.57883e-05       374.016       0.666       0.666     2084     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     2199      -6417.41   2.03482e-05       234.158           1           1     2294     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     2399      -6417.37   0.000196685       263.952           1           1     2505     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     2599      -6417.27    0.00020019        874.02           1           1     2712     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     2799       -6417.2   2.31778e-05       282.484      0.8335      0.8335     2922     #>     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes   #>     2917      -6417.09   5.16008e-07       58.1118           1           1     3045     #> Optimization terminated normally:   #>   Convergence detected: relative gradient magnitude is below tolerance  #> Finished in  1.4 seconds. #> Calculating Hessian  #> Calculating inverse of Cholesky factor  #> Generating draws  #> iteration: 0  #> iteration: 100  #> iteration: 200  #> iteration: 300  #> iteration: 400  #> iteration: 500  #> iteration: 600  #> iteration: 700  #> iteration: 800  #> iteration: 900  #> Finished in  0.8 seconds. #> CHELSEA  EVERETT     MALDEN  REVERE   #> -- apply estimates mx #>               CHELSEA     EVERETT        REVERE       MALDEN #> cbv1.l1  0.0451309468  0.05298088 -0.0005224117  0.017711625 #> cbv1.l2 -0.0223211761 -0.03592669  0.0184129771  0.012490790 #> cbv1.l3  0.0873424413  0.08593669  0.1029649763  0.093454486 #> cbv1.l4 -0.0335859603 -0.03578575 -0.0337628164 -0.041517343 #> cbv2.l1  0.0852368471  0.05049362 -0.0533811289  0.039648824 #> cbv2.l2  0.0166508607 -0.11934992  0.0747314454  0.055829432 #> cbv2.l3  0.1926712791  0.18510476  0.1393985118  0.118837565 #> cbv2.l4 -0.0462482063 -0.04542133 -0.0608086198 -0.054356689 #> cbv3.l1  0.0170645385  0.07301390  0.0257165131  0.038563344 #> cbv3.l2 -0.0005616437 -0.06948122  0.0223225434 -0.002010598 #> cbv3.l3  0.1718665757  0.12512136  0.1186064940  0.130222731 #> cbv3.l4 -0.0490847643 -0.01913613 -0.0655887549 -0.044893272  m_sb3$`_`$beta_mat #>            CHELSEA      EVERETT      MALDEN       REVERE #>  [1,]  0.026319525  0.026319693  0.02631967  0.026319835 #>  [2,] -0.005534506 -0.005534296 -0.00553427 -0.005534043 #>  [3,]  0.094720528  0.094720723  0.09472093  0.094721223 #>  [4,] -0.036462337 -0.036462215 -0.03646218 -0.036462030 #>  [5,]  0.017719019  0.017712262  0.01771736  0.017710263 #>  [6,]  0.011331487  0.011330544  0.01133091  0.011329994 #>  [7,]  0.160040095  0.160039608  0.16003934  0.160039051 #>  [8,] -0.054106971 -0.054107011 -0.05410700 -0.054106990 #>  [9,]  0.036384050  0.036384133  0.03638422  0.036384400 #> [10,] -0.011483545 -0.011483506 -0.01148341 -0.011483331 #> [11,]  0.134981224  0.134980961  0.13498120  0.134981046 #> [12,] -0.045758154 -0.045758204 -0.04575826 -0.045758549 subset(m_sb3$`_`$stan_summary, variable == 'q') #> # A tibble: 1 × 7 #>   variable  mean median    sd     mad    q5   q95 #>   <chr>    <dbl>  <dbl> <dbl>   <dbl> <dbl> <dbl> #> 1 q        0.936  0.998 0.181 0.00129 0.474 0.999"},{"path":"http://chadmilando.com/cityHeatHealth/articles/dlnm_sensitivity.html","id":"dlnm-sweep","dir":"Articles","previous_headings":"","what":"DLNM Sweep","title":"Exploring DLNM sensitivity in `cityHeatHealth`","text":"DLNM Sweep uses custom function called make_cb_list() expand crossbasis options: can see creates cb object basic DLNM (novel attributes removed): Ok now use fullest potential. One application might look like :","code":"# cb2 <- make_cb_list(x = lndn, #                     var_list = c('tmean'),  #                     argvar_list = list(set1 = list(fun=\"bs\", degree = 2, knots = list(vk))) , #                     lag_list = maxlag, #                     arglag_list = list(set1 = list(knots = list(lk)))) # attr(cb2[[1]], 'summary_str') <- NULL # attr(cb2[[1]], 'var_name') <- NULL # identical(cb, cb2[[1]]) # var_list <- c('tmean', 'tmin') #  # cb_all <- list() #  # for(var in var_list) { #    #   # make var knots that vary by var #   vk2 = equalknots(lndn[, var], fun=\"bs\", degree = 2, df = 4) #   vk3 = equalknots(lndn[, var], fun=\"ns\", df = 4) #   k50 = quantile(lndn[, var], probs = .5, na.rm = T) #   k10 = quantile(lndn[, var], probs = c(1:9)/10, na.rm = T) #    #   cb_var = make_cb_list(x = lndn, #                          var_list = var,  #                          argvar_list = list(set1 = list(fun=\"bs\", degree = c(2, 3),  #                                                         knots = list(vk2, k50, k10)), #                                             set2 = list(fun=\"ns\",   #                                                         knots = list(vk3, k50, k10))) , #                          lag_list = maxlag, #                          arglag_list = list(set1 = list(knots = list(lk)))) #    #   cb_all <- append(cb_all, cb_var) # }"},{"path":"http://chadmilando.com/cityHeatHealth/articles/one_stage_demo.html","id":"exposure-data","dir":"Articles","previous_headings":"","what":"Exposure data","title":"One set of Heat-Health Associations for a single or multiple zones using `cityHeatHealth`","text":"First let’s make exposure matrix single zone. simulated exposure dataset included package called ma_exposure, lists daily maximum temperatures day town. Notice dataset contains temperature whole year. good starting place. Also notice data messy, common environmental data, NA values days measurements: next step ’ll introduce function () cleans data (b) subsets just warm season months (Boston May September). good keep full temperature range point can use extra data around cutoffs make sure temperature matrix full. First, define column mapping. main geographic unit analysis (geo_unit) called TOWN20, however may also want aggregate later steps group level, grouping variable (geo_unit_grp) called COUNTY20. Providing named list way avoids rename columns throughout process. Next pass full temperature time-series step. can check two problems saw – missing data NA data – gone now probably good idea see systematic bias missingness (.e., data “missing random”) purposes tutorial ’ll assume (true since simulated data!). may also good idea check exposure values generally look like expect look (e.g., summary statistics), just make sure don’t need anys additional pre-processing (e.g., location-specific wildly high low temperatures, script catch ). time-series daily maximum temperatures warm-season months Boston MA, looks good!","code":"boston_exposure <- subset(ma_exposure, TOWN20 == 'BOSTON') head(boston_exposure) #>              date  tmax_C TOWN20 COUNTY20 #> 137783 2010-01-01 -0.3825 BOSTON  SUFFOLK #> 137784 2010-01-02  1.4337 BOSTON  SUFFOLK #> 137785 2010-01-03 -1.4163 BOSTON  SUFFOLK #> 137786 2010-01-04 -0.4483 BOSTON  SUFFOLK #> 137787 2010-01-05  0.6565 BOSTON  SUFFOLK #> 137788 2010-01-06  1.2098 BOSTON  SUFFOLK # Sept 17 2010 has NA data boston_exposure[255:260,] #>              date  tmax_C TOWN20 COUNTY20 #> 138037 2010-09-16 19.3761 BOSTON  SUFFOLK #> 138038 2010-09-17      NA BOSTON  SUFFOLK #> 138039 2010-09-18 19.0647 BOSTON  SUFFOLK #> 138040 2010-09-19 19.6014 BOSTON  SUFFOLK #> 138041 2010-09-20 23.6339 BOSTON  SUFFOLK #> 138042 2010-09-21 20.8122 BOSTON  SUFFOLK  # July 13 2010 is missing boston_exposure[190:195,] #>              date  tmax_C TOWN20 COUNTY20 #> 137972 2010-07-12 31.7248 BOSTON  SUFFOLK #> 137973 2010-07-14 31.9374 BOSTON  SUFFOLK #> 137974 2010-07-15 23.7004 BOSTON  SUFFOLK #> 137975 2010-07-16 28.7843 BOSTON  SUFFOLK #> 137976 2010-07-17 33.3453 BOSTON  SUFFOLK #> 137977 2010-07-18 33.1227 BOSTON  SUFFOLK exposure_columns <- list(   \"date\" = \"date\",   \"exposure\" = \"tmax_C\",   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) boston_exposure_mat <- make_exposure_matrix(boston_exposure, exposure_columns) #> Warning in make_exposure_matrix(boston_exposure, exposure_columns): check about any NA, some corrections for this later, #>             but only in certain columns head(boston_exposure_mat) #>          date  tmax_C TOWN20 COUNTY20  explag1  explag2  explag3  explag4 #>        <Date>   <num> <char>   <char>    <num>    <num>    <num>    <num> #> 1: 2010-05-01 23.1386 BOSTON  SUFFOLK 15.73815  8.33770 10.85230 16.44320 #> 2: 2010-05-02 26.1014 BOSTON  SUFFOLK 23.13860 15.73815  8.33770 10.85230 #> 3: 2010-05-03 31.5648 BOSTON  SUFFOLK 26.10140 23.13860 15.73815  8.33770 #> 4: 2010-05-04 27.7814 BOSTON  SUFFOLK 31.56480 26.10140 23.13860 15.73815 #> 5: 2010-05-05 26.2820 BOSTON  SUFFOLK 27.78140 31.56480 26.10140 23.13860 #> 6: 2010-05-06 25.8546 BOSTON  SUFFOLK 26.28200 27.78140 31.56480 26.10140 #>     explag5 #>       <num> #> 1: 18.74090 #> 2: 16.44320 #> 3: 10.85230 #> 4:  8.33770 #> 5: 15.73815 #> 6: 23.13860 # Sept 17 2010 now has NA data boston_exposure_mat[138:142,] #>          date  tmax_C TOWN20 COUNTY20 explag1 explag2 explag3 explag4 explag5 #>        <Date>   <num> <char>   <char>   <num>   <num>   <num>   <num>   <num> #> 1: 2010-09-15 22.5722 BOSTON  SUFFOLK 19.8015 18.5063 22.8082 20.9759 22.0336 #> 2: 2010-09-16 19.3761 BOSTON  SUFFOLK 22.5722 19.8015 18.5063 22.8082 20.9759 #> 3: 2010-09-17 19.2204 BOSTON  SUFFOLK 19.3761 22.5722 19.8015 18.5063 22.8082 #> 4: 2010-09-18 19.0647 BOSTON  SUFFOLK 19.2204 19.3761 22.5722 19.8015 18.5063 #> 5: 2010-09-19 19.6014 BOSTON  SUFFOLK 19.0647 19.2204 19.3761 22.5722 19.8015  # July 13 2010 is now not missing boston_exposure_mat[72:77,] #>          date  tmax_C TOWN20 COUNTY20 explag1 explag2 explag3 explag4 explag5 #>        <Date>   <num> <char>   <char>   <num>   <num>   <num>   <num>   <num> #> 1: 2010-07-11 29.1988 BOSTON  SUFFOLK 33.0867 32.8450 34.5714 37.1773 36.2254 #> 2: 2010-07-12 31.7248 BOSTON  SUFFOLK 29.1988 33.0867 32.8450 34.5714 37.1773 #> 3: 2010-07-13 31.8311 BOSTON  SUFFOLK 31.7248 29.1988 33.0867 32.8450 34.5714 #> 4: 2010-07-14 31.9374 BOSTON  SUFFOLK 31.8311 31.7248 29.1988 33.0867 32.8450 #> 5: 2010-07-15 23.7004 BOSTON  SUFFOLK 31.9374 31.8311 31.7248 29.1988 33.0867 #> 6: 2010-07-16 28.7843 BOSTON  SUFFOLK 23.7004 31.9374 31.8311 31.7248 29.1988 summary(boston_exposure_mat$tmax_C) #>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  #>   6.762  22.059  26.184  25.385  29.225  38.657"},{"path":"http://chadmilando.com/cityHeatHealth/articles/one_stage_demo.html","id":"outcome-data","dir":"Articles","previous_headings":"","what":"Outcome data","title":"One set of Heat-Health Associations for a single or multiple zones using `cityHeatHealth`","text":"Next let’s investigate deaths dataset - can see town level daily deaths category age group (0-17, 18-64, 65+) well binary-coded sex variable. Starts defining outcome columns: Notice several columns factors – right now sum within groups, introduce functionality later run models across multiple factors. exposure dataset, may days missing data, want aggregate data across factors aren’t using correct spatial unit analysis. make_outcome_table function accomplishes goals, Notice two variables added: strata. typically geo-unit (geo-unit-grp), year, month- day week (essential time- - space stratified conditional poisson model heat-heath impacts). geo-unit, results estimated geo-unit level. geo-unit-grp, results estimated geo-unit-grp level. (2) variable strata_total describing number total outcomes within strata","code":"boston_deaths   <- subset(ma_deaths, TOWN20 == 'BOSTON') head(boston_deaths) #>          date TOWN20 daily_deaths age_grp    sex COUNTY20 #>        <Date> <char>        <int>  <char> <char>   <char> #> 1: 2010-05-01 BOSTON          385    0-17      M  SUFFOLK #> 2: 2010-05-02 BOSTON          367    0-17      M  SUFFOLK #> 3: 2010-05-03 BOSTON          431    0-17      M  SUFFOLK #> 4: 2010-05-04 BOSTON          431    0-17      M  SUFFOLK #> 5: 2010-05-05 BOSTON          456    0-17      M  SUFFOLK #> 6: 2010-05-06 BOSTON          400    0-17      M  SUFFOLK outcome_columns <- list(   \"date\" = \"date\",   \"outcome\" = \"daily_deaths\",   \"factor\" = 'age_grp',   \"factor\" = 'sex',   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) boston_deaths_tbl <- make_outcome_table(boston_deaths,  outcome_columns) head(boston_deaths_tbl) #>          date TOWN20 COUNTY20 daily_deaths                 strata strata_total #>        <Date> <char>   <char>        <int>                 <char>        <num> #> 1: 2010-05-01 BOSTON  SUFFOLK         2238 BOSTON:yr2010:mn5:dow7        11312 #> 2: 2010-05-02 BOSTON  SUFFOLK         2089 BOSTON:yr2010:mn5:dow1        10929 #> 3: 2010-05-03 BOSTON  SUFFOLK         2374 BOSTON:yr2010:mn5:dow2        11435 #> 4: 2010-05-04 BOSTON  SUFFOLK         2354 BOSTON:yr2010:mn5:dow3         9372 #> 5: 2010-05-05 BOSTON  SUFFOLK         2489 BOSTON:yr2010:mn5:dow4         9193 #> 6: 2010-05-06 BOSTON  SUFFOLK         2191 BOSTON:yr2010:mn5:dow5         8657"},{"path":"http://chadmilando.com/cityHeatHealth/articles/one_stage_demo.html","id":"basic-dlnm-manual-walkthrough","dir":"Articles","previous_headings":"","what":"Basic DLNM (manual walkthrough)","title":"One set of Heat-Health Associations for a single or multiple zones using `cityHeatHealth`","text":"Now, ’ll walk basic DLNM heat-health associations single zone. assumes basic knowledge library(dlnm). libraries ’ll need run conditional poisson model. inputs define crossbasis matrix. use default ns behavior tails distribution linear. put lists argvar arglag: Limit columns exposure matrix just ones maxlag: Now run model Notice dispersion parameter quite high! , simulated data – part quasipoisson model works used re-scale variance covariance matrix. Next get crosspred outputs correctly centered minimum RR plot  Finally, basic checks math using utility functions estimate dispersion parameters variance-covariance matrix. functions useful longer using R functions estimate model. First check dispersion Next check vcov","code":"library(dlnm) library(gnm) library(ggplot2) library(data.table) arg_fun = 'ns' lag_fun = 'ns' x_knots = quantile(boston_exposure_mat$tmax_C, probs = c(0.5, 0.9)) maxlag = 5 nk = 2 argvar <- list(fun = arg_fun, knots = x_knots) arglag <- list(fun = lag_fun, knots = logknots(maxlag, nk = nk)) xcols <- c('tmax_C', paste0('explag',1:maxlag)) x_mat <- boston_exposure_mat[, ..xcols]  cb <- crossbasis(x_mat, lag = maxlag, argvar = argvar, arglag = arglag) m_sub <- gnm(daily_deaths ~ cb,              data = boston_deaths_tbl,              family = quasipoisson,              eliminate = factor(strata),              subset = strata_total > 0) summary(m_sub) #>  #> Call: #> gnm(formula = daily_deaths ~ cb, eliminate = factor(strata),  #>     family = quasipoisson, data = boston_deaths_tbl, subset = strata_total >  #>         0) #>  #> Deviance Residuals:  #>       Min         1Q     Median         3Q        Max   #> -4.256444  -1.184418  -0.001925   1.220153   4.449963   #>  #> Coefficients of interest: #>          Estimate Std. Error t value Pr(>|t|)     #> cbv1.l1  0.021822   0.010661   2.047  0.04088 *   #> cbv1.l2 -0.001086   0.009771  -0.111  0.91149     #> cbv1.l3  0.116198   0.006092  19.073  < 2e-16 *** #> cbv1.l4 -0.056545   0.006158  -9.183  < 2e-16 *** #> cbv2.l1  0.081805   0.037565   2.178  0.02961 *   #> cbv2.l2  0.002893   0.035155   0.082  0.93442     #> cbv2.l3  0.178086   0.023194   7.678 3.18e-14 *** #> cbv2.l4 -0.103412   0.022561  -4.584 5.01e-06 *** #> cbv3.l1  0.077537   0.023385   3.316  0.00094 *** #> cbv3.l2 -0.013910   0.021415  -0.650  0.51609     #> cbv3.l3  0.159186   0.014131  11.265  < 2e-16 *** #> cbv3.l4 -0.082510   0.013555  -6.087 1.51e-09 *** #> --- #> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 #>  #> (Dispersion parameter for quasipoisson family taken to be 3.366306) #>  #> Residual deviance: 4330.3 on 1286 degrees of freedom #> AIC: NA #>  #> Number of iterations: 2 cp <- crosspred(cb, m_sub, cen = 20, by = 0.1)  cen = cp$predvar[which.min(cp$allRRfit)]  cp <- crosspred(cb, m_sub, cen = cen, by = 0.1) plot_cp = data.frame(     x = cp$predvar,     RR = cp$allRRfit,     RRlow = cp$allRRlow,     RRhigh = cp$allRRhigh )  ggplot(plot_cp, aes(x = x, y = RR, ymin = RRlow, ymax = RRhigh)) +   geom_hline(yintercept = 1, linetype = '11') +   theme_classic() +   geom_ribbon(fill = 'grey75', alpha = 0.2) +   geom_line() + xlab(\"Tmax (degC)\") dispersion <- calc_dispersion(y = boston_deaths_tbl$daily_deaths,                  X = cb,                  stratum_vector = boston_deaths_tbl$strata,                  beta = coef(m_sub)) dispersion #> [1] 3.366306 vcov_beta <- calc_vcov(y = boston_deaths_tbl$daily_deaths,                  X = cb,                  stratum_vector = boston_deaths_tbl$strata,                  beta = coef(m_sub))  # update with the dipserion parameter t1 <- vcov_beta * dispersion  # check against the original model's vcov t2 <- vcov(m_sub) attributes(t2) <- NULL t2 <- matrix(t2, nrow = nrow(t1), ncol = ncol(t1))  # should be the same all.equal(t1, t2, tolerance = 1e-8) #> [1] TRUE"},{"path":"http://chadmilando.com/cityHeatHealth/articles/one_stage_demo.html","id":"basic-dlnm-using-cityheathealth-functions-in-r","dir":"Articles","previous_headings":"","what":"Basic DLNM (using cityHeatHealth functions in R)","title":"One set of Heat-Health Associations for a single or multiple zones using `cityHeatHealth`","text":"functionality encapsulated condPois_1stage function. one chief innovations package. Starting messy exposure outcome dataset, can quickly estimate heat-health impacts 3 lines. built-defaults argvar, arglag, maxlag investigation warm-season non-fatal health impacts associated increases temperature. don’t need check dispersion parameter since using gnm hood. plot relative risk ### Multi-zone DLNM can also easily extend 1 stage multi-zone case. don’t need include population offset within geo_unit:year:month:dow strata populations don’t change (one benefits conditional poisson setup – need include population offset time-series design). plot - notice tighter confidence interval","code":"# create exposure matrix exposure_columns <- list(   \"date\" = \"date\",   \"exposure\" = \"tmax_C\",   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) boston_exposure_mat <- make_exposure_matrix(boston_exposure, exposure_columns) #> Warning in make_exposure_matrix(boston_exposure, exposure_columns): check about any NA, some corrections for this later, #>             but only in certain columns  # create outcome table outcome_columns <- list(   \"date\" = \"date\",   \"outcome\" = \"daily_deaths\",   \"factor\" = 'age_grp',   \"factor\" = 'sex',   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) boston_deaths_tbl <- make_outcome_table(boston_deaths,  outcome_columns)  # run the model m1 <- condPois_1stage(exposure_matrix = boston_exposure_mat,                    outcomes_tbl = boston_deaths_tbl) plot(m1) # create exposure matrix exposure_columns <- list(   \"date\" = \"date\",   \"exposure\" = \"tmax_C\",   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) middlesex_exposure <- subset(ma_exposure, COUNTY20 == 'MIDDLESEX') middlesex_exposure_mat <- make_exposure_matrix(middlesex_exposure, exposure_columns) #> Warning in make_exposure_matrix(middlesex_exposure, exposure_columns): check about any NA, some corrections for this later, #>             but only in certain columns  # create outcome table outcome_columns <- list(   \"date\" = \"date\",   \"outcome\" = \"daily_deaths\",   \"factor\" = 'age_grp',   \"factor\" = 'sex',   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) middlesex_deaths   <- subset(ma_deaths, COUNTY20 == 'MIDDLESEX') middlesex_deaths_tbl <- make_outcome_table(middlesex_deaths,  outcome_columns)  # run the model m2 <- condPois_1stage(exposure_matrix = middlesex_exposure_mat,                    outcomes_tbl = middlesex_deaths_tbl, multi_zone = TRUE) plot(m2)"},{"path":"http://chadmilando.com/cityHeatHealth/articles/one_stage_demo.html","id":"multi-factor-single-beta-coeff","dir":"Articles","previous_headings":"","what":"Multi-factor single beta coeff","title":"One set of Heat-Health Associations for a single or multiple zones using `cityHeatHealth`","text":"can also get factors","code":"middlesex_deaths_tbl <- make_outcome_table(   middlesex_deaths,  outcome_columns, collapse_to = 'age_grp')  # run the model m3 <- condPois_1stage(exposure_matrix = middlesex_exposure_mat,                    outcomes_tbl = middlesex_deaths_tbl,                    multi_zone = TRUE)  # plot plot(m3)"},{"path":"http://chadmilando.com/cityHeatHealth/articles/quickstart.html","id":"starting-a-new-analysis","dir":"Articles","previous_headings":"","what":"Starting a new analysis","title":"Quickstart guide to `cityHeatHealth`","text":"start new analysis, need following 4 datasets: package comes pre-loaded sample datasets type (e.g., ma_exposure, ma_deaths, ma_pop_data, ma_towns respectively) methods can explored. See vignettes starter code type analysis.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/articles/quickstart.html","id":"additional-vignettes","dir":"Articles","previous_headings":"","what":"Additional vignettes","title":"Quickstart guide to `cityHeatHealth`","text":"also provide several additional vignettes common questions: vignette(\"comparison\"): comparison methods outputs tutorials vignette(\"dlnm_sensitivity\"): shows assess dlnm sensitivity vignette(\"get_pop_estimates\"): sample code get population estimates tidycensus vignette(“validation”)`: showing spatial bayesian methods work case numbers become small","code":""},{"path":"http://chadmilando.com/cityHeatHealth/articles/two_stage_demo.html","id":"model","dir":"Articles","previous_headings":"","what":"Model","title":"Heat-Health Associations across multiple towns using `cityHeatHealth`","text":"First create inputs, using exposure_columns outcome_columns . Now run using condPois_2stage. Gasp Extended2stage design 1 function inputs defaults argvar, arglag maxlag. Importantly, estimates geo_unit bolstered geo_unit_grp including random effect geo_unit_grp mixmeta model. can still view RR output single zone: seem like wider confidence interval solo model – Perhaps expected given variables around ? Worth investigating dataset, simulated data. can also plot geo_unit_grp (TODO – way make cleaner get )  can also make forest plot specific exposure value  Finally can also plot RR changes specific expsoure units across space – need bring sf shapefile:","code":"library(data.table) exposure_columns <- list(   \"date\" = \"date\",   \"exposure\" = \"tmax_C\",   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" )  ma_exposure_matrix <- make_exposure_matrix(subset(ma_exposure,COUNTY20 %in% c('MIDDLESEX', 'SUFFOLK') &            year(date) %in% 2012:2015), exposure_columns) #> Warning in make_exposure_matrix(subset(ma_exposure, COUNTY20 %in% c(\"MIDDLESEX\", : check about any NA, some corrections for this later, #>             but only in certain columns  outcome_columns <- list(   \"date\" = \"date\",   \"outcome\" = \"daily_deaths\",   \"factor\" = 'age_grp',   \"factor\" = 'sex',   \"geo_unit\" = \"TOWN20\",   \"geo_unit_grp\" = \"COUNTY20\" ) ma_outcomes_tbl <- make_outcome_table(subset(ma_deaths,COUNTY20 %in% c('MIDDLESEX', 'SUFFOLK') &            year(date) %in% 2012:2015), outcome_columns) ma_model <- condPois_2stage(ma_exposure_matrix, ma_outcomes_tbl, verbose = 1) #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2 plot(ma_model, \"BOSTON\") ma_model$`_`$grp_plt forest_plot(ma_model, 25.1) #> Warning in forest_plot.condPois_2stage(ma_model, 25.1): plotting by group since #> n_geos > 20 data(\"ma_towns\") ma_towns #> Simple feature collection with 351 features and 36 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: 33863.75 ymin: 777634.4 xmax: 330838.8 ymax: 959743 #> Projected CRS: NAD83 / Massachusetts Mainland #> # A tibble: 351 × 37 #>    STATEFP20 COUNTYFP20 COUSUBFP20 COUSUBNS20 GEOID20    NAMELSAD20       LSAD20 #>    <chr>     <chr>      <chr>      <chr>      <chr>      <chr>            <chr>  #>  1 25        003        34970      00618269   2500334970 Lenox town       43     #>  2 25        003        44385      00598751   2500344385 New Ashford town 43     #>  3 25        003        51580      00619422   2500351580 Otis town        43     #>  4 25        015        29265      00618202   2501529265 Hatfield town    43     #>  5 25        027        12715      00618359   2502712715 Charlton town    43     #>  6 25        011        05560      00619378   2501105560 Bernardston town 43     #>  7 25        003        59665      00619426   2500359665 Sandisfield town 43     #>  8 25        003        79985      00619430   2500379985 Williamstown to… 43     #>  9 25        017        31540      00618226   2501731540 Hudson town      43     #> 10 25        017        37875      00619404   2501737875 Malden city      25     #> # ℹ 341 more rows #> # ℹ 30 more variables: CLASSFP20 <chr>, MTFCC20 <chr>, CNECTAFP20 <chr>, #> #   NECTAFP20 <chr>, NCTADVFP20 <chr>, FUNCSTAT20 <chr>, ALAND20 <dbl>, #> #   AWATER20 <dbl>, INTPTLAT20 <chr>, INTPTLON20 <chr>, TOWN20 <chr>, #> #   TOWN_ID <int>, FIPS_STCO2 <dbl>, COUNTY20 <chr>, TYPE <chr>, #> #   FOURCOLOR <int>, AREA_ACRES <dbl>, SQ_MILES <dbl>, POP1960 <dbl>, #> #   POP1970 <dbl>, POP1980 <dbl>, POP1990 <dbl>, POP2000 <dbl>, … head(ma_towns) #> Simple feature collection with 6 features and 36 fields #> Geometry type: MULTIPOLYGON #> Dimension:     XY #> Bounding box:  xmin: 48979.71 ymin: 869246.6 xmax: 166957.3 ymax: 942838.1 #> Projected CRS: NAD83 / Massachusetts Mainland #> # A tibble: 6 × 37 #>   STATEFP20 COUNTYFP20 COUSUBFP20 COUSUBNS20 GEOID20 NAMELSAD20 LSAD20 CLASSFP20 #>   <chr>     <chr>      <chr>      <chr>      <chr>   <chr>      <chr>  <chr>     #> 1 25        003        34970      00618269   250033… Lenox town 43     T1        #> 2 25        003        44385      00598751   250034… New Ashfo… 43     T1        #> 3 25        003        51580      00619422   250035… Otis town  43     T1        #> 4 25        015        29265      00618202   250152… Hatfield … 43     T1        #> 5 25        027        12715      00618359   250271… Charlton … 43     T1        #> 6 25        011        05560      00619378   250110… Bernardst… 43     T1        #> # ℹ 29 more variables: MTFCC20 <chr>, CNECTAFP20 <chr>, NECTAFP20 <chr>, #> #   NCTADVFP20 <chr>, FUNCSTAT20 <chr>, ALAND20 <dbl>, AWATER20 <dbl>, #> #   INTPTLAT20 <chr>, INTPTLON20 <chr>, TOWN20 <chr>, TOWN_ID <int>, #> #   FIPS_STCO2 <dbl>, COUNTY20 <chr>, TYPE <chr>, FOURCOLOR <int>, #> #   AREA_ACRES <dbl>, SQ_MILES <dbl>, POP1960 <dbl>, POP1970 <dbl>, #> #   POP1980 <dbl>, POP1990 <dbl>, POP2000 <dbl>, POP2010 <dbl>, POP2020 <dbl>, #> #   POPCH10_20 <dbl>, HOUSING20 <dbl>, SHAPE_AREA <dbl>, SHAPE_LEN <dbl>, …  spatial_plot(ma_model, shp = ma_towns, exposure_val = 25.1)"},{"path":"http://chadmilando.com/cityHeatHealth/articles/two_stage_demo.html","id":"model-by-factor","dir":"Articles","previous_headings":"","what":"Model by factor","title":"Heat-Health Associations across multiple towns using `cityHeatHealth`","text":"small change required run model factor, e.g., age_grp: Run model plot","code":"ma_outcomes_tbl_fct <- make_outcome_table(subset(ma_deaths,COUNTY20 %in% c('MIDDLESEX', 'SUFFOLK') &            year(date) %in% 2012:2015),                                        outcome_columns,                                       collapse_to = 'age_grp') head(ma_outcomes_tbl_fct) #>          date    TOWN20  COUNTY20 age_grp daily_deaths #>        <Date>    <char>    <char>  <char>        <int> #> 1: 2012-05-01     ACTON MIDDLESEX    0-17           25 #> 2: 2012-05-01     ACTON MIDDLESEX   18-64           24 #> 3: 2012-05-01     ACTON MIDDLESEX     65+           24 #> 4: 2012-05-01 ARLINGTON MIDDLESEX    0-17           50 #> 5: 2012-05-01 ARLINGTON MIDDLESEX   18-64           48 #> 6: 2012-05-01 ARLINGTON MIDDLESEX     65+           50 #>                                    strata strata_total #>                                    <char>        <num> #> 1:      ACTON:yr2012:mn5:dow3:age_grp0-17          147 #> 2:     ACTON:yr2012:mn5:dow3:age_grp18-64          136 #> 3:       ACTON:yr2012:mn5:dow3:age_grp65+          140 #> 4:  ARLINGTON:yr2012:mn5:dow3:age_grp0-17          270 #> 5: ARLINGTON:yr2012:mn5:dow3:age_grp18-64          249 #> 6:   ARLINGTON:yr2012:mn5:dow3:age_grp65+          262 ma_model_fct <- condPois_2stage(ma_exposure_matrix, ma_outcomes_tbl_fct, verbose = 1) #> < age_grp : 0-17 > #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2 #> < age_grp : 18-64 > #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2 #> < age_grp : 65+ > #> -- validation passed #> -- stage 1 #> -- mixmeta #> -- stage 2 plot(ma_model_fct, \"BOSTON\") plot(ma_model_fct$`18-64`, \"BOSTON\", title = 'BOSTON: 18-64') forest_plot(ma_model_fct, 25.1) #> Warning in forest_plot.condPois_2stage_list(ma_model_fct, 25.1): plotting by #> group since n_geos > 20 spatial_plot(ma_model_fct, shp = ma_towns, exposure_val = 25.1)"},{"path":"http://chadmilando.com/cityHeatHealth/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"First Last. Author, maintainer.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Last F (2026). cityHeatHealth: Package (One Line, Title Case). R package version 0.0.0.9000, http://chadmilando.com/cityHeatHealth/.","code":"@Manual{,   title = {cityHeatHealth: What the Package Does (One Line, Title Case)},   author = {First Last},   year = {2026},   note = {R package version 0.0.0.9000},   url = {http://chadmilando.com/cityHeatHealth/}, }"},{"path":"http://chadmilando.com/cityHeatHealth/index.html","id":"starting-a-new-analysis","dir":"","previous_headings":"","what":"Starting a new analysis","title":"What the Package Does (One Line, Title Case)","text":"start new analysis, need following 4 datasets: package comes pre-loaded sample datasets type (e.g., ma_exposure, ma_deaths, ma_pop_data, ma_towns respectively) methods can explored. See vignettes starter code type analysis.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/index.html","id":"additional-vignettes","dir":"","previous_headings":"","what":"Additional vignettes","title":"What the Package Does (One Line, Title Case)","text":"also provide several additional vignettes common questions: vignette(\"comparison\"): comparison methods outputs tutorials vignette(\"dlnm_sensitivity\"): shows assess dlnm sensitivity vignette(\"get_pop_estimates\"): sample code get population estimates tidycensus vignette(“validation”)`: showing spatial bayesian methods work case numbers become small","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_AN.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate attributable number and attributable rates — calc_AN","title":"Calculate attributable number and attributable rates — calc_AN","text":"Calculate attributable number attributable rates","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_AN.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate attributable number and attributable rates — calc_AN","text":"","code":"calc_AN(   model,   outcomes_tbl,   pop_data,   agg_type,   join_cols,   nsim = 300,   verbose = 0 )"},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_AN.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate attributable number and attributable rates — calc_AN","text":"model model object class condPois_2stage, condPois_1stage, condPois_bayes outcomes_tbl table outcomes, class outcomes pop_data population data agg_type spatial resolution aggregating join_cols join population data outcome table nsim number simulations required calculation empirical CI (default = 300) verbose 0 = printing, 1 = headers, 2 = detailed","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_dispersion.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate the dispersion parameter for a quasi-poisson model — calc_dispersion","title":"Calculate the dispersion parameter for a quasi-poisson model — calc_dispersion","text":"Converted STATA armstrong 2014 supplement guidance ChatGPT","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_dispersion.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate the dispersion parameter for a quasi-poisson model — calc_dispersion","text":"","code":"calc_dispersion(y, X, beta, stratum_vector)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_dispersion.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate the dispersion parameter for a quasi-poisson model — calc_dispersion","text":"y vector outcomes X matrix predictors, typically crossbasis output beta vector coefficients stratum_vector vector describing stratum","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_vcov.html","id":null,"dir":"Reference","previous_headings":"","what":"Calculate the variance-covariance matrix of a Conditional poisson model — calc_vcov","title":"Calculate the variance-covariance matrix of a Conditional poisson model — calc_vcov","text":"https://link.springer.com/article/10.1007/s11222-005-4069-4 https://statomics.github.io/SGA2019/assets/poissonIRWLS-implemented.html#variance-covariance-matrix---model-parameters","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_vcov.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calculate the variance-covariance matrix of a Conditional poisson model — calc_vcov","text":"","code":"calc_vcov(y, X, beta, stratum_vector)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_vcov.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calculate the variance-covariance matrix of a Conditional poisson model — calc_vcov","text":"y vector outcomes X matrix predictors, typically crossbasis output beta vector coefficients stratum_vector vector describing stratum","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/calc_vcov.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calculate the variance-covariance matrix of a Conditional poisson model — calc_vcov","text":"extended multi-nomial case, help LLM, confirmed works. refs https://doi.org/10.1111/j.2517-6161.1996.tb02079.x https://doi.org/10.1093/biomet/68.2.563","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/check_argvar.html","id":null,"dir":"Reference","previous_headings":"","what":"Internal function to check argvar — check_argvar","title":"Internal function to check argvar — check_argvar","text":"Internal function check argvar","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/check_argvar.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Internal function to check argvar — check_argvar","text":"","code":"check_argvar(argvar, this_exp)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/check_argvar.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Internal function to check argvar — check_argvar","text":"this_exp","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/cityHeatHealth-package.html","id":null,"dir":"Reference","previous_headings":"","what":"The 'cityHeatHealth' package. — cityHeatHealth-package","title":"The 'cityHeatHealth' package. — cityHeatHealth-package","text":"DESCRIPTION PACKAGE","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/cityHeatHealth-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"The 'cityHeatHealth' package. — cityHeatHealth-package","text":"Stan Development Team (NA). RStan: R interface Stan. R package version 2.32.7. https://mc-stan.org","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/cityHeatHealth-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"The 'cityHeatHealth' package. — cityHeatHealth-package","text":"Maintainer: First Last first.last@example.com","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_1stage.html","id":null,"dir":"Reference","previous_headings":"","what":"Run a conditional poisson model for a single geographic unit — condPois_1stage","title":"Run a conditional poisson model for a single geographic unit — condPois_1stage","text":"Run conditional poisson model single geographic unit","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_1stage.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run a conditional poisson model for a single geographic unit — condPois_1stage","text":"","code":"condPois_1stage(   exposure_matrix,   outcomes_tbl,   argvar = NULL,   arglag = NULL,   maxlag = NULL,   min_n = NULL,   strata_min = 0,   global_cen = NULL,   multi_zone = FALSE )"},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_1stage.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run a conditional poisson model for a single geographic unit — condPois_1stage","text":"exposure_matrix matrix exposures, columns lag, usually created make_exposure_matrix outcomes_tbl data.table outcomes, created make_outcome_table argvar list containing argvar components crossbasis arglag list containing arglag components crossbasis maxlag integer maximum lag min_n integer describing minimum number cases single region strata_min integer describing minimum number cases single strata global_cen global centering point multi_zone multiple strata used.","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_2stage.html","id":null,"dir":"Reference","previous_headings":"","what":"Run a conditional poisson model for across many geographic units — condPois_2stage","title":"Run a conditional poisson model for across many geographic units — condPois_2stage","text":"MixMeta nope : https://www.sciencedirect.com/science/article/pii/S0140673614621140?via%3Dihub avgtmax range random effect county unclear, Gasp https://github.com/gasparrini/RiskExtrapolation/blob/3caa5c46a748d6a789021554f435e53f9960d4c1/24_MetaRegression.R goes counrty/city https://github.com/gasparrini/MCC-SO2/blob/1a158b31bf83f3bbca3449b553a6570280306299/Rcode/06.nonlin.R#L47 nlmeta <- mixmeta(nlcoefall, nlvcovall, random=~1|country/city, data=cities, control=list(showiter=T, igls.inititer=10)) basically, Gasp 2015 (temp_mean, temp_iqr, random effect county) included hierarchicacy structure ids within countries https://github.com/gasparrini/2015_gasparrini_EHP_Rcodedata https://github.com/gasparrini/2019_sera_StatMed_Rcode/blob/master/03.MultilevelMA.R","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_2stage.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run a conditional poisson model for across many geographic units — condPois_2stage","text":"","code":"condPois_2stage(   exposure_matrix,   outcomes_tbl,   global_cen = NULL,   argvar = NULL,   arglag = NULL,   maxlag = NULL,   min_n = NULL,   strata_min = 0,   verbose = 0 )"},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_2stage.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run a conditional poisson model for across many geographic units — condPois_2stage","text":"exposure_matrix matrix exposures, columns lag, usually created make_exposure_matrix outcomes_tbl data.table outcomes, created make_outcome_table global_cen global centering point argvar list containing argvar components crossbasis arglag list containing arglag components crossbasis maxlag integer maximum lag min_n integer describing minimum number cases single region strata_min minimum number cases per strata verbose whether print geo_units run","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_2stage.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Run a conditional poisson model for across many geographic units — condPois_2stage","text":"update 2025.12.21, https://github.com/gasparrini/Extended2stage/blob/cf82fd2f0d616210e8aa6911d2fb49a732f65795/02.multilevel.R#L68","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_sb.html","id":null,"dir":"Reference","previous_headings":"","what":"Run a conditional poisson model with Spatial Bayesian inference — condPois_sb","title":"Run a conditional poisson model with Spatial Bayesian inference — condPois_sb","text":"https://mc-stan.org/docs/2_20/functions-reference/multinomial-distribution.html","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_sb.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run a conditional poisson model with Spatial Bayesian inference — condPois_sb","text":"","code":"condPois_sb(   exposure_matrix,   outcomes_tbl,   shp_sf,   stan_type = \"laplace\",   use_spatial_model = T,   stan_opts = NULL,   global_cen = NULL,   argvar = NULL,   arglag = NULL,   maxlag = NULL,   min_n = NULL,   strata_min = 0,   verbose = 0 )"},{"path":"http://chadmilando.com/cityHeatHealth/reference/condPois_sb.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run a conditional poisson model with Spatial Bayesian inference — condPois_sb","text":"exposure_matrix matrix exposures, columns lag, usually created make_exposure_matrix outcomes_tbl data.table outcomes, created make_outcome_table shp_sf shapefile object describing geo_units stan_type choice either laplace sample stan_opts list parameters send stan global_cen global centering point argvar list containing argvar components crossbasis arglag list containing arglag components crossbasis maxlag integer maximum lag min_n integer describing minimum number cases single region strata_min minimum number cases per strata verbose whether print geo_units run","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/expand_arglist.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — expand_arglist","title":"Title — expand_arglist","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/expand_arglist.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — expand_arglist","text":"","code":"expand_arglist(arglist)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/expand_arglist.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — expand_arglist","text":"arglist","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/forest_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"forest_plot base class — forest_plot","title":"forest_plot base class — forest_plot","text":"forest_plot base class","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/forest_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"forest_plot base class — forest_plot","text":"","code":"forest_plot(x, ...)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/forest_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"forest_plot base class — forest_plot","text":"...","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/getSW.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — getSW","title":"Title — getSW","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/getSW.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — getSW","text":"","code":"getSW(shp, ni, include_self = T)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/getSW.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — getSW","text":"include_self","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/getSmat.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — getSmat","title":"Title — getSmat","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/getSmat.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — getSmat","text":"","code":"getSmat(strata_vector)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/getSmat.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — getSmat","text":"strata_vector","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/get_centered_cp.html","id":null,"dir":"Reference","previous_headings":"","what":"Internal function to get centered cp objects — get_centered_cp","title":"Internal function to get centered cp objects — get_centered_cp","text":"Needed function twice: regional RRs BLUP","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/get_centered_cp.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Internal function to get centered cp objects — get_centered_cp","text":"","code":"get_centered_cp(argvar, xcoef, xvcov, this_exp, x_b, global_cen, cen)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/get_centered_cp.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Internal function to get centered cp objects — get_centered_cp","text":"cen","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/indexByComponent.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — indexByComponent","title":"Title — indexByComponent","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/indexByComponent.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — indexByComponent","text":"","code":"indexByComponent(x)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/indexByComponent.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — indexByComponent","text":"x","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_counties.html","id":null,"dir":"Reference","previous_headings":"","what":"Massachusetts Towns and Cities (2020 Census) — ma_counties","title":"Massachusetts Towns and Cities (2020 Census) — ma_counties","text":"dataset containing geographic identifiers, administrative classifications, land water area, population counts, housing units, related attributes counties Massachusetts. See link","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_counties.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Massachusetts Towns and Cities (2020 Census) — ma_counties","text":"shapefile one row per Massachusetts city town following variables: FIPSID Character COUNTY20 Character. 2020 Census county FIPS code. AREA_ACRES Numeric. OBJECTID Numeric. SHAPE_AREA Numeric. SHAPE_LEN Numeric. geometry Numeric.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_counties.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Massachusetts Towns and Cities (2020 Census) — ma_counties","text":"U.S. Census Bureau, 2020 Decennial Census; TIGER/MAF geographic products.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_counties.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Massachusetts Towns and Cities (2020 Census) — ma_counties","text":"dataset typically used environmental exposure assessment can joined town-level geographic demographic datasets using COUNTY20.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_deaths.html","id":null,"dir":"Reference","previous_headings":"","what":"Daily Deaths by Town — ma_deaths","title":"Daily Deaths by Town — ma_deaths","text":"SIMULATED dataset containing fictional daily deaths linked Massachusetts towns. row represents single day–town observation.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_deaths.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Daily Deaths by Town — ma_deaths","text":"data frame one row per date town following variables: date Date. Calendar date observation. daily_deaths Numeric. Daily deaths - SIMULATED! age_grp Character. Either '0-17', '18-64' '65+' sex Character. either 'M' 'F' example TOWN20 Character. Name Massachusetts town associated temperature observation. COUNTY20 Character. Name Massachusetts county associated TOWN20.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_deaths.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Daily Deaths by Town — ma_deaths","text":"dataset typically used environmental exposure assessment can joined town-level geographic demographic datasets using TOWN20.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_exposure.html","id":null,"dir":"Reference","previous_headings":"","what":"Daily Maximum Temperature Exposure by Town — ma_exposure","title":"Daily Maximum Temperature Exposure by Town — ma_exposure","text":"SIMULATED dataset containing fictional daily maximum temperature measurements linked Massachusetts towns. row represents single day–town observation corresponding maximum temperature degrees Celsius.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_exposure.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Daily Maximum Temperature Exposure by Town — ma_exposure","text":"data frame one row per date town following variables: date Date. Calendar date observation. tmax_C Numeric. Daily maximum air temperature degrees Celsius. TOWN20 Character. Name Massachusetts town associated temperature observation. COUNTY20 Character. Name Massachusetts county associated TOWN20.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_exposure.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Daily Maximum Temperature Exposure by Town — ma_exposure","text":"dataset typically used environmental exposure assessment can joined town-level geographic demographic datasets using TOWN20.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":null,"dir":"Reference","previous_headings":"","what":"Massachusetts town-level population by sex and age group — ma_pop_data","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"town-level population dataset Massachusetts derived American Community Survey (ACS) 5-year estimates. Populations aggregated sex (Male, Female) broad age groups (0–17, 18–64, 65 older) Massachusetts cities towns.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"","code":"ma_pop_data"},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"data frame one row per town following variables: TOWN20 Character. Name Massachusetts town Male_0_17 Numeric. Estimated population males aged 0–17 years. Male_18_64 Numeric. Estimated population males aged 18–64 years. Male_65_plus Numeric. Estimated population males aged 65 years older. Female_0_17 Numeric. Estimated population females aged 0–17 years. Female_18_64 Numeric. Estimated population females aged 18–64 years. Female_65_plus Numeric. Estimated population females aged 65 years older.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"U.S. Census Bureau, American Community Survey 5-Year Estimates.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"Geographic units correspond Census county subdivisions (COUSUB), align cities towns New England states. dataset includes 351 Massachusetts cities towns. Population estimates based ACS table B01001 (Sex Age) aggregated Census age bins three broad age groups commonly used public health analyses. Estimates represent pooled 5-year ACS values subject sampling error. dataset suitable use denominators rate calculations, age-stratified analyses, small-area public health modeling Massachusetts.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"U.S. Census Bureau. American Community Survey 5-Year Data (ACS5). Sex Age, Table B01001.","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_pop_data.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Massachusetts town-level population by sex and age group — ma_pop_data","text":"","code":"# View population totals for a single town subset(ma_pop_data, TOWN20 == \"BOSTON\") #> # A tibble: 1 × 7 #>   TOWN20 `Female_0-17` `Female_18-64` `Female_65+` `Male_0-17` `Male_18-64` #>   <chr>          <dbl>          <dbl>        <dbl>       <dbl>        <dbl> #> 1 BOSTON         50490         247351        47313       53784       232284 #> # ℹ 1 more variable: `Male_65+` <dbl>"},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_towns.html","id":null,"dir":"Reference","previous_headings":"","what":"Massachusetts Towns and Cities (2020 Census) — ma_towns","title":"Massachusetts Towns and Cities (2020 Census) — ma_towns","text":"dataset containing geographic identifiers, administrative classifications, land water area, population counts, housing units, related attributes cities towns Massachusetts, primarily based 2020 U.S. Census TIGER/MAF products. See link","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_towns.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Massachusetts Towns and Cities (2020 Census) — ma_towns","text":"shapefile one row per Massachusetts city town following variables: STATEFP Character. 2020 Census state FIPS code. COUNTYFP Character. 2020 Census county FIPS code. COUSUBFP Character. 2020 Census county subdivision FIPS code. COUSUBNS Character. 2020 Census ANSI feature code county subdivision. GEOID Character. 2020 Census county subdivision identifier (STATEFP + COUNTYFP + COUSUBFP). NAMELSAD Character. Name translated legal/statistical area description county subdivision. LSAD Character. Legal/statistical area description code county subdivision. CLASSFP Character. 2020 Census FIPS class code. MTFCC Character. MAF/TIGER Feature Class Code (G4040). CNECTAFP Character. 2020 Census combined New England city town area code. NECTAFP Character. 2020 Census New England city town area code. NCTADVFP Character. 2020 Census New England city town area division code. FUNCSTAT Character. 2020 Census functional status. ALAND Numeric. 2020 Census land area square meters. AWATER Numeric. 2020 Census water area square meters. INTPTLAT Character. Latitude internal point (2020 Census). INTPTLON Character. Longitude internal point (2020 Census). TOWN20 Character. Official name city town. TOWN_ID Integer. Town ID assigned official town name. FIPS_STCO Integer. Federal Information Processing Standard (state/county) code. COUNTY20 Character. Name county town located. TYPE Character. Municipality type: C = City; T = Town; TC = Town city form government. FOURCOLOR Integer. Four-color shading code (1–4) adjacent towns share code. AREA_ACRES Numeric. Area town acres. SQ_MILES Numeric. Area town square miles. Shape_Length Numeric. Perimeter town meters. Shape_Area Numeric. Area town square meters. POP1960 Integer. U.S. Census population 1960. POP1970 Integer. U.S. Census population 1970. POP1980 Integer. U.S. Census population 1980. POP1990 Integer. U.S. Census population 1990. POP2000 Integer. U.S. Census population 2000. POP2010 Integer. U.S. Census population 2010. POP2020 Integer. 2020 Census population count (PL 94-171 redistricting data). POPCH10_20 Integer. Change population 2010 2020. HOUSING20 Integer. 2020 Census count housing units (PL 94-171).","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_towns.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Massachusetts Towns and Cities (2020 Census) — ma_towns","text":"U.S. Census Bureau, 2020 Decennial Census; TIGER/MAF geographic products.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/ma_towns.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Massachusetts Towns and Cities (2020 Census) — ma_towns","text":"dataset typically used environmental exposure assessment can joined town-level geographic demographic datasets using TOWN20.","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_cb_list.html","id":null,"dir":"Reference","previous_headings":"","what":"make_cb_list — make_cb_list","title":"make_cb_list — make_cb_list","text":"make_cb_list","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_cb_list.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"make_cb_list — make_cb_list","text":"","code":"make_cb_list(x, var_list, argvar_list, lag_list, arglag_list)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_cb_list.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"make_cb_list — make_cb_list","text":"arglag_list","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_exposure_matrix.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to clean and prepare the exposure data matrix — make_exposure_matrix","title":"Function to clean and prepare the exposure data matrix — make_exposure_matrix","text":"Function clean prepare exposure data matrix","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_exposure_matrix.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to clean and prepare the exposure data matrix — make_exposure_matrix","text":"","code":"make_exposure_matrix(   data,   column_mapping,   warm_season_months = 5:9,   maxgap = 5,   maxlag = 5,   grp_level = FALSE )"},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_exposure_matrix.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to clean and prepare the exposure data matrix — make_exposure_matrix","text":"data dataset exposures column_mapping named list indicates relevant columns data. exposure data table, need one : c('date', \"exposure\", 'geo_unit', 'geo_unit_grp') warm_season_months warm season months region, default Northern Hemisphere's May September (5 9) maxlag number lags exposure variable (default 5) grp_level whether summarize group level (default) maxgaps maximum allowable missing exposure data gap, passed zoo::na.approx (default 5)","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_exposure_matrix.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to clean and prepare the exposure data matrix — make_exposure_matrix","text":"data.table class(\"exposure\")","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_outcome_table.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to create the outcome table — make_outcome_table","title":"Function to create the outcome table — make_outcome_table","text":"Function create outcome table","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_outcome_table.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to create the outcome table — make_outcome_table","text":"","code":"make_outcome_table(   data,   column_mapping,   warm_season_months = 5:9,   collapse_to = NULL,   grp_level = FALSE )"},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_outcome_table.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to create the outcome table — make_outcome_table","text":"column_mapping named list indicates relevant columns data. exposure data table, need one : c('date', \"outcome\",'factor, 'geo_unit', 'geo_unit_grp') warm_season_months warm season months region, default Northern Hemisphere's May September (5 9) collapse_to factors collapse across grp_level whether summarize group level (default)","code":""},{"path":[]},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_xgrid.html","id":null,"dir":"Reference","previous_headings":"","what":"An internal function to make the xgrid — make_xgrid","title":"An internal function to make the xgrid — make_xgrid","text":"internal function make xgrid","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/make_xgrid.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"An internal function to make the xgrid — make_xgrid","text":"","code":"make_xgrid(data, column_mapping, months = 1:12)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/nb2graph.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — nb2graph","title":"Title — nb2graph","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/nb2graph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — nb2graph","text":"","code":"nb2graph(x)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/nb2graph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — nb2graph","text":"x","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/nb2subgraph.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — nb2subgraph","title":"Title — nb2subgraph","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/nb2subgraph.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — nb2subgraph","text":"","code":"nb2subgraph(x, c_id, comp_ids, offsets)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/nb2subgraph.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — nb2subgraph","text":"offsets","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/nx.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — nx","title":"Title — nx","text":"Title","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/nx.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — nx","text":"","code":"nx(xx, ni, include_self = T)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/nx.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — nx","text":"include_self","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/scale_nb_components.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — scale_nb_components","title":"Title — scale_nb_components","text":"https://github.com/stan-dev/example-models/blob/master/knitr/car-iar-poisson/nb_data_funs.R","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/scale_nb_components.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — scale_nb_components","text":"","code":"scale_nb_components(x)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/scale_nb_components.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — scale_nb_components","text":"x","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/spatial_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"spatial_plot base class — spatial_plot","title":"spatial_plot base class — spatial_plot","text":"spatial_plot base class","code":""},{"path":"http://chadmilando.com/cityHeatHealth/reference/spatial_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"spatial_plot base class — spatial_plot","text":"","code":"spatial_plot(x, ...)"},{"path":"http://chadmilando.com/cityHeatHealth/reference/spatial_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"spatial_plot base class — spatial_plot","text":"...","code":""}]
