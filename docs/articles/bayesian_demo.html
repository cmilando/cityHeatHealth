<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Spatial Bayesian methods in `cityHeatHealth` • cityHeatHealth</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using Spatial Bayesian methods in `cityHeatHealth`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cityHeatHealth</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cityHeatHealth.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/one_stage_demo.html">One set of Heat-Health Associations for a single or multiple zones using `cityHeatHealth`</a></li>
    <li><a class="dropdown-item" href="../articles/two_stage_demo.html">Heat-Health Associations across multiple towns using `cityHeatHealth`</a></li>
    <li><a class="dropdown-item" href="../articles/bayesian_demo.html">Using Spatial Bayesian methods in `cityHeatHealth`</a></li>
    <li><a class="dropdown-item" href="../articles/attributable_number.html">Calculating attributable numbers and rates in `cityHeatHealth`</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using Spatial Bayesian methods in `cityHeatHealth`</h1>
            
      

      <div class="d-none name"><code>bayesian_demo.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://chadmilando.com/cityHeatHealth/">cityHeatHealth</a></span><span class="op">)</span></span></code></pre></div>
<p>Another way that this model can be solved is by using Bayesian
inference, implemented in STAN. We are including this implementation
here so that it makes sense why we are including it later on.</p>
<p>The innovation here is combining the method of Armstrong 2014 with a
spatial method, in this case BYM2</p>
<p>We implemented the spatial bayesian method of BYM2 but instead of
regular poisson as a conditional poisson (i.e., multinomial) which has
performance gains that they articulate in Amrstrong.</p>
<p>This requires bringing in a shapefile, so you can define the
network</p>
<p>The standard application is using MCMC, we also include all STAN
model types:</p>
<ul>
<li>MCMC</li>
<li>laplace</li>
<li>variational</li>
<li>pathfinder</li>
</ul>
<p>You can also experiment with speeding things up (at the risk of less
precise estimates) using the laplace or variational method. see Jack’s
notes as so what is going on here</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ma_exposure"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ma_deaths"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create exposure matrix</span></span>
<span><span class="va">exposure_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"date"</span> <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>  <span class="st">"exposure"</span> <span class="op">=</span> <span class="st">"tmax_C"</span>,</span>
<span>  <span class="st">"geo_unit"</span> <span class="op">=</span> <span class="st">"TOWN20"</span>,</span>
<span>  <span class="st">"geo_unit_grp"</span> <span class="op">=</span> <span class="st">"COUNTY20"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">TOWNLIST</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CHELSEA'</span>, <span class="st">'EVERETT'</span>, <span class="st">'REVERE'</span>, <span class="st">'MALDEN'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exposure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ma_exposure</span>, <span class="va">TOWN20</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span>  <span class="va">TOWNLIST</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exposure_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_exposure_matrix.html">make_exposure_matrix</a></span><span class="op">(</span><span class="va">exposure</span>, <span class="va">exposure_columns</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in make_exposure_matrix(exposure, exposure_columns): check about any NA, some corrections for this later,</span></span>
<span><span class="co">#&gt;             but only in certain columns</span></span>
<span></span>
<span><span class="co"># create outcome table</span></span>
<span><span class="va">outcome_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"date"</span> <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>  <span class="st">"outcome"</span> <span class="op">=</span> <span class="st">"daily_deaths"</span>,</span>
<span>  <span class="st">"factor"</span> <span class="op">=</span> <span class="st">'age_grp'</span>,</span>
<span>  <span class="st">"factor"</span> <span class="op">=</span> <span class="st">'sex'</span>,</span>
<span>  <span class="st">"geo_unit"</span> <span class="op">=</span> <span class="st">"TOWN20"</span>,</span>
<span>  <span class="st">"geo_unit_grp"</span> <span class="op">=</span> <span class="st">"COUNTY20"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">deaths</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ma_deaths</span>, <span class="va">TOWN20</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">TOWNLIST</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span></span>
<span><span class="va">deaths_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_outcome_table.html">make_outcome_table</a></span><span class="op">(</span><span class="va">deaths</span>,  <span class="va">outcome_columns</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ma_towns"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">local_shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ma_towns</span>, <span class="va">TOWN20</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span>  <span class="va">TOWNLIST</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">local_shp</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">TOWN20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesian_demo_files/figure-html/setup2-1.png" class="r-plt" width="480"></p>
<p>Now get initial estimates for each <code>geo_unit</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span> </span>
<span><span class="va">cr_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span> </span>
<span><span class="va">plot_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cb_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">oo_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">bb</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condPois_1stage.html">condPois_1stage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exposure_mat</span>, <span class="va">TOWN20</span> <span class="op">==</span> <span class="va">TOWNLIST</span><span class="op">[</span><span class="va">bb</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">deaths_tbl</span>, <span class="va">TOWN20</span> <span class="op">==</span> <span class="va">TOWNLIST</span><span class="op">[</span><span class="va">bb</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">cb_list</span><span class="op">[[</span><span class="va">bb</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m1</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">orig_basis</span></span>
<span>  <span class="va">oo_list</span><span class="op">[[</span><span class="va">bb</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m1</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">outcomes</span></span>
<span>  </span>
<span>  <span class="va">beta_l</span><span class="op">[[</span><span class="va">bb</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m1</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">orig_coef</span></span>
<span>  </span>
<span>  <span class="va">cr_l</span><span class="op">[[</span><span class="va">bb</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">m1</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">coef</span></span>
<span>  </span>
<span>  <span class="va">plot_l</span><span class="op">[[</span><span class="va">bb</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="va">mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">beta_l</span><span class="op">)</span> <span class="co"># COEFS NOT THE SAME</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mx</span><span class="op">)</span>  <span class="op">=</span> <span class="va">TOWNLIST</span></span>
<span><span class="va">mx</span></span>
<span><span class="co">#&gt;               CHELSEA     EVERETT        REVERE       MALDEN</span></span>
<span><span class="co">#&gt; cbv1.l1  0.0451309468  0.05298088 -0.0005224117  0.017711625</span></span>
<span><span class="co">#&gt; cbv1.l2 -0.0223211761 -0.03592669  0.0184129771  0.012490790</span></span>
<span><span class="co">#&gt; cbv1.l3  0.0873424413  0.08593669  0.1029649763  0.093454486</span></span>
<span><span class="co">#&gt; cbv1.l4 -0.0335859603 -0.03578575 -0.0337628164 -0.041517343</span></span>
<span><span class="co">#&gt; cbv2.l1  0.0852368471  0.05049362 -0.0533811289  0.039648824</span></span>
<span><span class="co">#&gt; cbv2.l2  0.0166508607 -0.11934992  0.0747314454  0.055829432</span></span>
<span><span class="co">#&gt; cbv2.l3  0.1926712791  0.18510476  0.1393985118  0.118837565</span></span>
<span><span class="co">#&gt; cbv2.l4 -0.0462482063 -0.04542133 -0.0608086198 -0.054356689</span></span>
<span><span class="co">#&gt; cbv3.l1  0.0170645385  0.07301390  0.0257165131  0.038563344</span></span>
<span><span class="co">#&gt; cbv3.l2 -0.0005616437 -0.06948122  0.0223225434 -0.002010598</span></span>
<span><span class="co">#&gt; cbv3.l3  0.1718665757  0.12512136  0.1186064940  0.130222731</span></span>
<span><span class="co">#&gt; cbv3.l4 -0.0490847643 -0.01913613 -0.0655887549 -0.044893272</span></span>
<span></span>
<span><span class="va">mcr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">cr_l</span><span class="op">)</span>   <span class="co"># COEFS THE SAME</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mcr</span><span class="op">)</span>  <span class="op">=</span> <span class="va">TOWNLIST</span></span>
<span><span class="va">mcr</span></span>
<span><span class="co">#&gt;      CHELSEA   EVERETT    REVERE    MALDEN</span></span>
<span><span class="co">#&gt; b1 0.1847675 0.1774954 0.2034421 0.1922760</span></span>
<span><span class="co">#&gt; b2 0.4637942 0.3065562 0.2523009 0.2921484</span></span>
<span><span class="co">#&gt; b3 0.3375227 0.2624969 0.2438566 0.2749740</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plot_l</span><span class="op">)</span></span></code></pre></div>
<p><img src="bayesian_demo_files/figure-html/b2-1.png" class="r-plt" width="480"></p>
<p>the cr coefs are similar</p>
<p>the orig_coefs are not, which is why beta-wise implementation of
SB_DLNM method doesn’t work - because the don’t have to be the same to
produce similar curves.</p>
<p>So, instead of forcing Beta to be similar, we can use bym2</p>
<p>refs:</p>
<ul>
<li><a href="https://mc-stan.org/learn-stan/case-studies/icar_stan.html" class="external-link uri">https://mc-stan.org/learn-stan/case-studies/icar_stan.html</a></li>
<li><a href="https://link.springer.com/article/10.1186/1476-072X-4-31" class="external-link uri">https://link.springer.com/article/10.1186/1476-072X-4-31</a></li>
<li><a href="https://github.com/stan-dev/example-models/blob/e5b7d9e2e9ecc375805c7e49e4a4d4c1882b5e3b/knitr/car-iar-poisson/bym2_predictor_plus_offset.stan#L4" class="external-link uri">https://github.com/stan-dev/example-models/blob/e5b7d9e2e9ecc375805c7e49e4a4d4c1882b5e3b/knitr/car-iar-poisson/bym2_predictor_plus_offset.stan#L4</a></li>
</ul>
<p>ok here’s the ref of how LAPLACE works:</p>
<ul>
<li><a href="https://mc-stan.org/cmdstanr/reference/model-method-laplace.html" class="external-link uri">https://mc-stan.org/cmdstanr/reference/model-method-laplace.html</a></li>
<li><a href="https://statmodeling.stat.columbia.edu/2023/02/08/implementing-laplace-approximation-in-stan-whats-happening-under-the-hood/" class="external-link uri">https://statmodeling.stat.columbia.edu/2023/02/08/implementing-laplace-approximation-in-stan-whats-happening-under-the-hood/</a></li>
</ul>
<p>I think this makes for a good candidate because betas are normal and
the model is not hierarchical</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_sb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condPois_sb.html">condPois_sb</a></span><span class="op">(</span><span class="va">exposure_mat</span>, <span class="va">deaths_tbl</span>, <span class="va">local_shp</span>, </span>
<span>                     stan_type <span class="op">=</span> <span class="st">'mcmc'</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                     stan_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refresh <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>                     use_spatial_model <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span><span class="co">#&gt;  STAN TYPE = mcmc </span></span>
<span><span class="co">#&gt;  SPATIAL MODEL = none </span></span>
<span><span class="co">#&gt; -- validation passed</span></span>
<span><span class="co">#&gt; -- prepare inputs</span></span>
<span><span class="co">#&gt; CHELSEA  EVERETT     MALDEN  REVERE  </span></span>
<span><span class="co">#&gt; Warning in getSW(shp = shp_sf_safe, ni = 1, include_self = F): has to be one</span></span>
<span><span class="co">#&gt; polygon per row in `shp`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- run STAN</span></span>
<span><span class="co">#&gt;  ...mcmc... </span></span>
<span><span class="co">#&gt; Running MCMC with 2 parallel chains...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 2 finished in 28.7 seconds.</span></span>
<span><span class="co">#&gt; Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span><span class="co">#&gt; Chain 1 finished in 29.0 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Both chains finished successfully.</span></span>
<span><span class="co">#&gt; Mean chain execution time: 28.9 seconds.</span></span>
<span><span class="co">#&gt; Total execution time: 29.1 seconds.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ...mcmc draws... </span></span>
<span><span class="co">#&gt; CHELSEA  EVERETT     MALDEN  REVERE  </span></span>
<span><span class="co">#&gt; -- apply estimates</span></span></code></pre></div>
<p>Compare, first you can see that with spatial_model = F, there is
similarity in beta coefs</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mx</span></span>
<span><span class="co">#&gt;               CHELSEA     EVERETT        REVERE       MALDEN</span></span>
<span><span class="co">#&gt; cbv1.l1  0.0451309468  0.05298088 -0.0005224117  0.017711625</span></span>
<span><span class="co">#&gt; cbv1.l2 -0.0223211761 -0.03592669  0.0184129771  0.012490790</span></span>
<span><span class="co">#&gt; cbv1.l3  0.0873424413  0.08593669  0.1029649763  0.093454486</span></span>
<span><span class="co">#&gt; cbv1.l4 -0.0335859603 -0.03578575 -0.0337628164 -0.041517343</span></span>
<span><span class="co">#&gt; cbv2.l1  0.0852368471  0.05049362 -0.0533811289  0.039648824</span></span>
<span><span class="co">#&gt; cbv2.l2  0.0166508607 -0.11934992  0.0747314454  0.055829432</span></span>
<span><span class="co">#&gt; cbv2.l3  0.1926712791  0.18510476  0.1393985118  0.118837565</span></span>
<span><span class="co">#&gt; cbv2.l4 -0.0462482063 -0.04542133 -0.0608086198 -0.054356689</span></span>
<span><span class="co">#&gt; cbv3.l1  0.0170645385  0.07301390  0.0257165131  0.038563344</span></span>
<span><span class="co">#&gt; cbv3.l2 -0.0005616437 -0.06948122  0.0223225434 -0.002010598</span></span>
<span><span class="co">#&gt; cbv3.l3  0.1718665757  0.12512136  0.1186064940  0.130222731</span></span>
<span><span class="co">#&gt; cbv3.l4 -0.0490847643 -0.01913613 -0.0655887549 -0.044893272</span></span>
<span></span>
<span><span class="va">m_sb1</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">beta_mat</span></span>
<span><span class="co">#&gt;           CHELSEA     EVERETT      MALDEN        REVERE</span></span>
<span><span class="co">#&gt;  [1,]  0.04563081  0.05352101  0.01681938 -0.0007161936</span></span>
<span><span class="co">#&gt;  [2,] -0.02310974 -0.03545623  0.01349965  0.0180104763</span></span>
<span><span class="co">#&gt;  [3,]  0.08724563  0.08576537  0.09334545  0.1028893168</span></span>
<span><span class="co">#&gt;  [4,] -0.03350999 -0.03532395 -0.04105760 -0.0331877843</span></span>
<span><span class="co">#&gt;  [5,]  0.08698833  0.04810957  0.03598086 -0.0511078793</span></span>
<span><span class="co">#&gt;  [6,]  0.01534864 -0.11608512  0.06032731  0.0744266904</span></span>
<span><span class="co">#&gt;  [7,]  0.19255327  0.18545340  0.11679099  0.1364912451</span></span>
<span><span class="co">#&gt;  [8,] -0.04584014 -0.04524805 -0.05158503 -0.0596107002</span></span>
<span><span class="co">#&gt;  [9,]  0.01789267  0.07015688  0.03754349  0.0284379689</span></span>
<span><span class="co">#&gt; [10,] -0.00093469 -0.06706039 -0.00138018  0.0211865836</span></span>
<span><span class="co">#&gt; [11,]  0.17143376  0.12552996  0.12973764  0.1171559579</span></span>
<span><span class="co">#&gt; [12,] -0.04891770 -0.02000770 -0.04463672 -0.0651447948</span></span></code></pre></div>
<div class="section level3">
<h3 id="compare-with-spatial-model">Compare with spatial model<a class="anchor" aria-label="anchor" href="#compare-with-spatial-model"></a>
</h3>
<p>using laplace in this case, but you could try mcmc</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_sb2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condPois_sb.html">condPois_sb</a></span><span class="op">(</span><span class="va">exposure_mat</span>, <span class="va">deaths_tbl</span>, <span class="va">local_shp</span>, </span>
<span>                     stan_type <span class="op">=</span> <span class="st">'laplace'</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                     stan_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refresh <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>                     use_spatial_model <span class="op">=</span> <span class="st">'bym2'</span><span class="op">)</span></span>
<span><span class="co">#&gt;  STAN TYPE = laplace </span></span>
<span><span class="co">#&gt;  SPATIAL MODEL = bym2 </span></span>
<span><span class="co">#&gt; -- validation passed</span></span>
<span><span class="co">#&gt; -- prepare inputs</span></span>
<span><span class="co">#&gt; CHELSEA  EVERETT     MALDEN  REVERE  </span></span>
<span><span class="co">#&gt; Warning in getSW(shp = shp_sf_safe, ni = 1, include_self = F): has to be one</span></span>
<span><span class="co">#&gt; polygon per row in `shp`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- run STAN</span></span>
<span><span class="co">#&gt;  ...laplace optimize... </span></span>
<span><span class="co">#&gt; Initial log joint probability = -6739.06 </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      139      -6737.26   0.000348121      0.731762           1           1      169    </span></span>
<span><span class="co">#&gt; Optimization terminated normally:  </span></span>
<span><span class="co">#&gt;   Convergence detected: relative gradient magnitude is below tolerance </span></span>
<span><span class="co">#&gt; Finished in  0.2 seconds.</span></span>
<span><span class="co">#&gt;  ...laplace sample... </span></span>
<span><span class="co">#&gt; Calculating Hessian </span></span>
<span><span class="co">#&gt; Calculating inverse of Cholesky factor </span></span>
<span><span class="co">#&gt; Generating draws </span></span>
<span><span class="co">#&gt; iteration: 0 </span></span>
<span><span class="co">#&gt; iteration: 100 </span></span>
<span><span class="co">#&gt; iteration: 200 </span></span>
<span><span class="co">#&gt; iteration: 300 </span></span>
<span><span class="co">#&gt; iteration: 400 </span></span>
<span><span class="co">#&gt; iteration: 500 </span></span>
<span><span class="co">#&gt; iteration: 600 </span></span>
<span><span class="co">#&gt; iteration: 700 </span></span>
<span><span class="co">#&gt; iteration: 800 </span></span>
<span><span class="co">#&gt; iteration: 900 </span></span>
<span><span class="co">#&gt; Finished in  0.7 seconds.</span></span>
<span><span class="co">#&gt;  ...laplace draws... </span></span>
<span><span class="co">#&gt; CHELSEA  EVERETT     MALDEN  REVERE  </span></span>
<span><span class="co">#&gt; -- apply estimates</span></span></code></pre></div>
<p>Compare, now you can see these are different</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mx</span></span>
<span><span class="co">#&gt;               CHELSEA     EVERETT        REVERE       MALDEN</span></span>
<span><span class="co">#&gt; cbv1.l1  0.0451309468  0.05298088 -0.0005224117  0.017711625</span></span>
<span><span class="co">#&gt; cbv1.l2 -0.0223211761 -0.03592669  0.0184129771  0.012490790</span></span>
<span><span class="co">#&gt; cbv1.l3  0.0873424413  0.08593669  0.1029649763  0.093454486</span></span>
<span><span class="co">#&gt; cbv1.l4 -0.0335859603 -0.03578575 -0.0337628164 -0.041517343</span></span>
<span><span class="co">#&gt; cbv2.l1  0.0852368471  0.05049362 -0.0533811289  0.039648824</span></span>
<span><span class="co">#&gt; cbv2.l2  0.0166508607 -0.11934992  0.0747314454  0.055829432</span></span>
<span><span class="co">#&gt; cbv2.l3  0.1926712791  0.18510476  0.1393985118  0.118837565</span></span>
<span><span class="co">#&gt; cbv2.l4 -0.0462482063 -0.04542133 -0.0608086198 -0.054356689</span></span>
<span><span class="co">#&gt; cbv3.l1  0.0170645385  0.07301390  0.0257165131  0.038563344</span></span>
<span><span class="co">#&gt; cbv3.l2 -0.0005616437 -0.06948122  0.0223225434 -0.002010598</span></span>
<span><span class="co">#&gt; cbv3.l3  0.1718665757  0.12512136  0.1186064940  0.130222731</span></span>
<span><span class="co">#&gt; cbv3.l4 -0.0490847643 -0.01913613 -0.0655887549 -0.044893272</span></span>
<span></span>
<span><span class="va">m_sb2</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">beta_mat</span></span>
<span><span class="co">#&gt;            CHELSEA     EVERETT        MALDEN        REVERE</span></span>
<span><span class="co">#&gt;  [1,]  0.045423333  0.05112039  1.900732e-02  0.0003361363</span></span>
<span><span class="co">#&gt;  [2,] -0.021520151 -0.03348218  1.168377e-02  0.0171357910</span></span>
<span><span class="co">#&gt;  [3,]  0.086169530  0.08576237  9.202635e-02  0.1026162647</span></span>
<span><span class="co">#&gt;  [4,] -0.033034684 -0.03701113 -4.046737e-02 -0.0336513220</span></span>
<span><span class="co">#&gt;  [5,]  0.088049683  0.04858261  3.603389e-02 -0.0514857925</span></span>
<span><span class="co">#&gt;  [6,]  0.019462978 -0.11101076  6.234808e-02  0.0752953200</span></span>
<span><span class="co">#&gt;  [7,]  0.187765616  0.18230330  1.161435e-01  0.1368418551</span></span>
<span><span class="co">#&gt;  [8,] -0.042253687 -0.04710544 -5.393741e-02 -0.0612077042</span></span>
<span><span class="co">#&gt;  [9,]  0.016094283  0.07222675  3.729183e-02  0.0263192109</span></span>
<span><span class="co">#&gt; [10,]  0.001261148 -0.06617505  4.976655e-05  0.0224012337</span></span>
<span><span class="co">#&gt; [11,]  0.172412859  0.12429712  1.292206e-01  0.1186910900</span></span>
<span><span class="co">#&gt; [12,] -0.048785974 -0.01986296 -4.510412e-02 -0.0658182839</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-with-spatial-model-for-leroux">Compare with spatial model for leroux<a class="anchor" aria-label="anchor" href="#compare-with-spatial-model-for-leroux"></a>
</h3>
<p>using laplace in this case, but you could try mcmc</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m_sb3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/condPois_sb.html">condPois_sb</a></span><span class="op">(</span><span class="va">exposure_mat</span>, </span>
<span>                     <span class="va">deaths_tbl</span>, <span class="va">local_shp</span>, </span>
<span>                     stan_type <span class="op">=</span> <span class="st">'laplace'</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                     stan_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>refresh <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>                     use_spatial_model <span class="op">=</span> <span class="st">'leroux'</span><span class="op">)</span></span>
<span><span class="co">#&gt;  STAN TYPE = laplace </span></span>
<span><span class="co">#&gt;  SPATIAL MODEL = leroux </span></span>
<span><span class="co">#&gt; -- validation passed</span></span>
<span><span class="co">#&gt; -- prepare inputs</span></span>
<span><span class="co">#&gt; CHELSEA  EVERETT     MALDEN  REVERE  </span></span>
<span><span class="co">#&gt; Warning in getSW(shp = shp_sf_safe, ni = 1, include_self = F): has to be one</span></span>
<span><span class="co">#&gt; polygon per row in `shp`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- run STAN</span></span>
<span><span class="co">#&gt;  ...laplace optimize... </span></span>
<span><span class="co">#&gt; Initial log joint probability = -7000.25 </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      199      -6518.16     0.0317223        386.68           1           1      215    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      399      -6438.84     0.0763665       11799.7      0.5406           1      425    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      599      -6393.62      0.027489       12270.4           1           1      635    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      799       -6371.4    0.00210131       22054.6           1           1      849    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;      999      -6362.85   2.48342e-06       1876.72           1           1     1060    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1199      -6360.11   1.70314e-06       1926.29           1           1     1272    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1399       -6359.2   1.63738e-06       1871.19           1           1     1480    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1599      -6358.77   1.14602e-05       1174.76           1           1     1690    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1799      -6357.61   0.000191241       7846.74           1           1     1897    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     1999      -6356.56   1.89901e-05       1981.71           1           1     2106    </span></span>
<span><span class="co">#&gt;     Iter      log prob        ||dx||      ||grad||       alpha      alpha0  # evals  Notes  </span></span>
<span><span class="co">#&gt;     2152      -6355.97   2.89835e-07       242.602           1           1     2271    </span></span>
<span><span class="co">#&gt; Optimization terminated normally:  </span></span>
<span><span class="co">#&gt;   Convergence detected: relative gradient magnitude is below tolerance </span></span>
<span><span class="co">#&gt; Finished in  1.1 seconds.</span></span>
<span><span class="co">#&gt;  ...laplace sample... </span></span>
<span><span class="co">#&gt; Calculating Hessian </span></span>
<span><span class="co">#&gt; Calculating inverse of Cholesky factor </span></span>
<span><span class="co">#&gt; Generating draws </span></span>
<span><span class="co">#&gt; iteration: 0 </span></span>
<span><span class="co">#&gt; iteration: 100 </span></span>
<span><span class="co">#&gt; iteration: 200 </span></span>
<span><span class="co">#&gt; iteration: 300 </span></span>
<span><span class="co">#&gt; iteration: 400 </span></span>
<span><span class="co">#&gt; iteration: 500 </span></span>
<span><span class="co">#&gt; iteration: 600 </span></span>
<span><span class="co">#&gt; iteration: 700 </span></span>
<span><span class="co">#&gt; iteration: 800 </span></span>
<span><span class="co">#&gt; iteration: 900 </span></span>
<span><span class="co">#&gt; Finished in  0.8 seconds.</span></span>
<span><span class="co">#&gt;  ...laplace draws... </span></span>
<span><span class="co">#&gt; CHELSEA  EVERETT     MALDEN  REVERE  </span></span>
<span><span class="co">#&gt; -- apply estimates</span></span></code></pre></div>
<p>As you can see, lots of smoothing to a central estimate !</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mx</span></span>
<span><span class="co">#&gt;               CHELSEA     EVERETT        REVERE       MALDEN</span></span>
<span><span class="co">#&gt; cbv1.l1  0.0451309468  0.05298088 -0.0005224117  0.017711625</span></span>
<span><span class="co">#&gt; cbv1.l2 -0.0223211761 -0.03592669  0.0184129771  0.012490790</span></span>
<span><span class="co">#&gt; cbv1.l3  0.0873424413  0.08593669  0.1029649763  0.093454486</span></span>
<span><span class="co">#&gt; cbv1.l4 -0.0335859603 -0.03578575 -0.0337628164 -0.041517343</span></span>
<span><span class="co">#&gt; cbv2.l1  0.0852368471  0.05049362 -0.0533811289  0.039648824</span></span>
<span><span class="co">#&gt; cbv2.l2  0.0166508607 -0.11934992  0.0747314454  0.055829432</span></span>
<span><span class="co">#&gt; cbv2.l3  0.1926712791  0.18510476  0.1393985118  0.118837565</span></span>
<span><span class="co">#&gt; cbv2.l4 -0.0462482063 -0.04542133 -0.0608086198 -0.054356689</span></span>
<span><span class="co">#&gt; cbv3.l1  0.0170645385  0.07301390  0.0257165131  0.038563344</span></span>
<span><span class="co">#&gt; cbv3.l2 -0.0005616437 -0.06948122  0.0223225434 -0.002010598</span></span>
<span><span class="co">#&gt; cbv3.l3  0.1718665757  0.12512136  0.1186064940  0.130222731</span></span>
<span><span class="co">#&gt; cbv3.l4 -0.0490847643 -0.01913613 -0.0655887549 -0.044893272</span></span>
<span></span>
<span><span class="va">m_sb3</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">beta_mat</span></span>
<span><span class="co">#&gt;            CHELSEA      EVERETT       MALDEN       REVERE</span></span>
<span><span class="co">#&gt;  [1,]  0.007393641  0.007393784  0.007394247  0.007393496</span></span>
<span><span class="co">#&gt;  [2,]  0.005909126  0.005908665  0.005909324  0.005909028</span></span>
<span><span class="co">#&gt;  [3,]  0.101804062  0.101805289  0.101804801  0.101804395</span></span>
<span><span class="co">#&gt;  [4,] -0.044028808 -0.044029393 -0.044029676 -0.044029059</span></span>
<span><span class="co">#&gt;  [5,] -0.045403324 -0.045399940 -0.045397528 -0.045397372</span></span>
<span><span class="co">#&gt;  [6,]  0.046002454  0.046006165  0.046005329  0.046004261</span></span>
<span><span class="co">#&gt;  [7,]  0.187302489  0.187302192  0.187301543  0.187302563</span></span>
<span><span class="co">#&gt;  [8,] -0.079967398 -0.079968486 -0.079967632 -0.079968145</span></span>
<span><span class="co">#&gt;  [9,]  0.009569402  0.009569678  0.009569970  0.009570108</span></span>
<span><span class="co">#&gt; [10,]  0.011026743  0.011027348  0.011027609  0.011027644</span></span>
<span><span class="co">#&gt; [11,]  0.141515048  0.141515237  0.141514517  0.141515253</span></span>
<span><span class="co">#&gt; [12,] -0.056311461 -0.056311481 -0.056310680 -0.056311312</span></span></code></pre></div>
<p>And you can also see that the leroux <code>q</code> value is quite
high</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">m_sb3</span><span class="op">$</span><span class="va">`_`</span><span class="op">$</span><span class="va">stan_summary</span>, <span class="va">variable</span> <span class="op">==</span> <span class="st">'q'</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   variable  mean median    sd   mad    q5   q95</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> q        0.631  0.640 0.113 0.112 0.437 0.808</span></span></code></pre></div>
<p>All of the other objects associated with <code>condPois_1stage</code>
or <code>condPois_2stage</code> will also work here, along with the
<code>_list</code> and factor coding</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://chadmilando.com" class="external-link">Chad Milando</a>, <a href="https://www.bu.edu/sph/profile/emma-gause/" class="external-link">Emma Gause</a>, <a href="https://www.colorado.edu/oclab/quinn-adams" class="external-link">Quinn Adams</a>, <a href="https://www.bu.edu/sph/profile/zachary-popp/" class="external-link">Zachary Popp</a>, <a href="https://www.bu.edu/sph/profile/gregory-wellenius/" class="external-link">Gregory Wellenius</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
